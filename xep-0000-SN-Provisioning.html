<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>XEP-xxxx: Sensor Networks - Provisioning</title>
    <link rel="stylesheet" type="text/css" href="xmpp.css">
    <link href="prettify.css" type="text/css" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico"><script type="text/javascript" src="prettify.js"></script><meta name="DC.Title" content="Sensor Networks - Provisioning">
    <meta name="DC.Creator" content="Peter Waher">
    <meta name="DC.Description" content="This specification describes an architecture for efficient provisioning of services, access rights and user privileges in sensor networks.">
    <meta name="DC.Publisher" content="XMPP Standards Foundation">
    <meta name="DC.Contributor" content="XMPP Extensions Editor">
    <meta name="DC.Date" content="2013-03-18">
    <meta name="DC.Type" content="XMPP Extension Protocol">
    <meta name="DC.Format" content="XHTML">
    <meta name="DC.Identifier" content="XEP-xxxx">
    <meta name="DC.Language" content="en">
    <meta name="DC.Rights" content="This XMPP Extension Protocol is copyright (c) 1999 - 2013 by the XMPP Standards Foundation (XSF).">
  </head>
  <body onload="prettyPrint()">
    <h1>XEP-xxxx: Sensor Networks - Provisioning</h1>
    <table>
      <tr valign="top">
        <td><strong>Abstract:</strong></td>
        <td>This specification describes an architecture for efficient provisioning of services, access rights and user privileges in sensor networks.</td>
      </tr>
      <tr valign="top">
        <td><strong>Author:</strong></td>
        <td>Peter Waher</td>
      </tr>
      <tr valign="top">
        <td><strong>Copyright:</strong></td>
        <td>© 1999 - 2013 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</td>
      </tr>
      <tr valign="top">
        <td><strong>Status:</strong></td>
        <td>ProtoXEP</td>
      </tr>
      <tr valign="top">
        <td><strong>Type:</strong></td>
        <td>Standards Track</td>
      </tr>
      <tr valign="top">
        <td><strong>Version:</strong></td>
        <td>0.0.3</td>
      </tr>
      <tr valign="top">
        <td><strong>Last Updated:</strong></td>
        <td>2013-03-18</td>
      </tr>
    </table>
    <hr>
    <p style="color:red">WARNING: This document has not yet been accepted for consideration or approved in any official manner by the XMPP Standards Foundation, and this document is not yet an XMPP Extension Protocol (XEP). If this document is accepted as a XEP by the XMPP Council, it will be published at &lt;<a href="http://xmpp.org/extensions/">http://xmpp.org/extensions/</a>&gt; and announced on the &lt;standards@xmpp.org&gt; mailing list.</p>
    <hr>
    <h2>Table of Contents</h2>
    <div class="indent">
      <p><br>1.  <a href="#intro">Introduction</a><br>2.  <a href="#glossary">Glossary</a><br>3.  <a href="#usecases">Use Cases</a><br>   
      3.1.  <a href="#sect-ID0EROAC">Delegating original trust to a Provisioning Server</a><br>   
      3.2.  <a href="#sect-ID0ESBAE">Friendship request accepted</a><br>   
      3.3.  <a href="#sect-ID0E1CAE">Friendship request rejected</a><br>   
      3.4.  <a href="#sect-ID0ESDAE">Unfriending existing friends</a><br>   
      3.5.  <a href="#sect-ID0EREAE">Recommending friendships</a><br>   
      3.6.  <a href="#sect-ID0EMFAE">Rejecting read-outs</a><br>   
      3.7.  <a href="#sect-ID0EXGAE">Restricting nodes during read-out</a><br>   
      3.8.  <a href="#sect-ID0EJIAE">Restricting fields during read-out</a><br>   
      3.9.  <a href="#sect-ID0EVJAE">Clear cache</a><br>   
      3.10.  <a href="#sect-ID0ERKAE">Getting a service token</a><br>   
      3.11.  <a href="#sect-ID0E4KAE">User access to service</a><br>   
      3.12.  <a href="#sect-ID0EORAE">User privileges in service</a><br>   
      3.13.  <a href="#sect-ID0EVVAE">Download all user privileges</a><br>   
      3.14.  <a href="#sect-ID0EQWAE">Delegating Secondary Trust</a><br>   
      3.15.  <a href="#sect-ID0EKXAE">Multiple tokens</a><br>4.  <a href="#support">Determining Support</a><br>5.  <a href="#impl">Implementation Notes</a><br>   
      5.1.  <a href="#sect-ID0EMZAE">Caching and cache time</a><br>   
      5.2.  <a href="#sect-ID0EF1AE">Working with multiple provisioning servers</a><br>   
      5.3.  <a href="#sect-ID0ED2AE">Automatic aggregation of services, users and privileges</a><br>   
      5.4.  <a href="#sect-ID0EM2AE">Reading devices from large subsystems</a><br>   
      5.5.  <a href="#sect-ID0ER3AE">Different types of tokens</a><br>6.  <a href="#security">Security Considerations</a><br>7.  <a href="#iana">IANA Considerations</a><br>8.  <a href="#registrar">XMPP Registrar Considerations</a><br>9.  <a href="#schema">XML Schema</a><br>10.  <a href="#ack">Acknowledgements</a></p>
      <p><a href="#appendices">Appendices</a><br>    <a href="#appendix-docinfo">A: Document Information</a><br>    <a href="#appendix-authorinfo">B: Author Information</a><br>    <a href="#appendix-legal">C: Legal Notices</a><br>    <a href="#appendix-xmpp">D: Relation to XMPP</a><br>    <a href="#appendix-discuss">E: Discussion Venue</a><br>    <a href="#appendix-conformance">F: Requirements Conformance</a><br>    <a href="#appendix-notes">G: Notes</a><br>    <a href="#appendix-revs">H: Revision History</a></p>
    </div>
    <hr>
    <h2>1.
       <a name="intro">Introduction</a></h2>
        <p class="" style="">
            This XEP provides the underlying architecture, basic operations and data structures for provisioning of services, access rights and user privileges in sensor networks.
        </p>
        <p class="" style="">
            Note has to be taken, that these XEP's are designed for implementation in sensors, many of which have very limited amount of memory (both RAM and ROM) or resources (processing power).
            Therefore, simplicity is of utmost importance. Furthermore, sensor networks can become huge, easily containing millions of devices in peer-to-peer networks.
        </p>
        <p class="" style="">
            An added complexity in the provisioning case is that sensors often have very limited user interface options. Therefore, this document explains how provisioning can be done
            efficiently using a trusted third party with more power and options when it comes to user interface design and storage.
        </p>
        <p class="" style="">
			This XEP relies heavily on <a href="xep-0000-SN-SensorData.html">xep-0000-SN-SensorData</a>  [<a href="#nt-ID0EUE">1</a>].
			Sensor networks contain many different architectures and use cases. For this reason, the sensor network standards have been divided into multiple XEPs according to the following table:
		</p>

        <div class="indent">
      <p class="caption"><a name="table-1"></a>Table 1: Sensor Network XEPs</p>
      <table border="1" cellpadding="3" cellspacing="0">
            <tr class="body">
                <th colspan="" rowspan="">XEP</th>
                <th colspan="" rowspan="">Description</th>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">XEP-0000-DynamicForms</td>
                <td colspan="" rowspan="">Defines extensions for how dynamic forms can be created, based on <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0004.html">Data Forms</a></span>  [<a href="#nt-ID0EXF">2</a>], <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0122.html">Data Forms Validation</a></span>  [<a href="#nt-ID0EDG">3</a>], <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0137.html">Publishing Stream Initiation Requests</a></span>  [<a href="#nt-ID0EPG">4</a>] and <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0141.html">Data Forms Layout</a></span>  [<a href="#nt-ID0E2G">5</a>].</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">XEP-0000-Exi</td>
                <td colspan="" rowspan="">
                    Defines how to EXI can be used in XMPP to achieve efficient compression of data. Albeit not a sensor network specific XEP, this XEP should be considered
                    in all sensor network implementations where memory and packet size is an issue.
                </td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-SN-BatteryPoweredSensors</td>
                <td colspan="" rowspan="">Defines how to handle the peculiars related to battery powered devices, and other devices intermittently available on the network.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-SN-Concentrators</td>
                <td colspan="" rowspan="">Defines how to handle architectures containing concentrators or servers handling multiple sensors.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-SN-Control</td>
                <td colspan="" rowspan="">Defines how to control actuators and other devices in sensor networks.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-SN-Discovery</td>
                <td colspan="" rowspan="">Defines the peculiars of sensor discovery in sensor networks. Apart from discovering sensors by JID, it also defines how to discover sensors based on location, etc.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-SN-Events</td>
                <td colspan="" rowspan="">Defines how sensors send events, how event subscription, hysteresis levels, etc., are configured.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-SN-Interoperability</td>
                <td colspan="" rowspan="">Defines guidelines for how to achieve interoperability in sensor networks, publishing interoperability interfaces for different types of devices.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-SN-Multicast</td>
                <td colspan="" rowspan="">Defines how sensor data can be multicast in efficient ways.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-SN-Provisioning</td>
                <td colspan="" rowspan="">This specification. Defines how provisioning, the management of access privileges, etc., can be efficiently and easily implemented.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-SN-PubSub</td>
                <td colspan="" rowspan="">Defines how efficient publication of sensor data can be made in sensor networks.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-SN-SensorData</td>
                <td colspan="" rowspan="">
                    Provides the underlying architecture, basic operations and data structures for sensor data communication over XMPP networks.
                    It includes a hardware abstraction model, removing any technical detail implemented in underlying technologies. This XEP is used by all other sensor network XEPs.
                </td>
            </tr>
        </table>
    </div>
    <h2>2.
       <a name="glossary">Glossary</a></h2>
        <p class="" style="">The following table lists common terms and corresponding descriptions.</p>
        <div class="indent">
      <p class="caption"><a name="table-2"></a>Table 2: Glossary</p>
      <table border="1" cellpadding="3" cellspacing="0">
            <tr class="body">
                <th colspan="" rowspan="">Term</th>
                <th colspan="" rowspan="">Description</th>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Actuator</td>
                <td colspan="" rowspan="">Device containing at least one configurable property or output that can and should be controlled by some other entity or device.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Computed Value</td>
                <td colspan="" rowspan="">A value that is computed instead of measured.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Concentrator</td>
                <td colspan="" rowspan="">Device managing a set of devices which it publishes on the XMPP network.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Field</td>
                <td colspan="" rowspan="">
                    One item of sensor data. Contains information about: Node, Field Name, Value, Precision, Unit, Value Type, Status, Timestamp, Localization information, etc.
                    Fields should be unique within the triple (Node ID, Field Name, Timestamp).
                </td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Field Name</td>
                <td colspan="" rowspan="">Name of a field of sensor data. Examples: Energy, Volume, Flow, Power, etc.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Field Type</td>
                <td colspan="" rowspan="">What type of value the field represents. Examples: Momentary Value, Status Value, Identification Value, Calculated Value, Peak Value, Historical Value, etc.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Historical Value</td>
                <td colspan="" rowspan="">A value stored in memory from a previous timestamp.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Identification Value</td>
                <td colspan="" rowspan="">A value that can be used for identification. (Serial numbers, meter IDs, locations, names, etc.)</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Localization information</td>
                <td colspan="" rowspan="">Optional information for a field, allowing the sensor to control how the information should be presented to human viewers.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Meter</td>
                <td colspan="" rowspan="">A device possible containing multiple sensors, used in metering applications. Examples: Electricity meter, Water Meter, Heat Meter, Cooling Meter, etc.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Momentary Value</td>
                <td colspan="" rowspan="">A momentary value represents a value measured at the time of the read-out.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Node</td>
                <td colspan="" rowspan="">
                    Graphs contain nodes and edges between nodes. In Sensor Networks, sensors, actuators, meters, devices, gateways, etc., are often depicted as nodes and links between sensors (friendships)
                    are depicted as edges. In abstract terms, it's easier to talk about a Node, than have to list different types of nodes possible (sensors, actuators, meters, devices, gateways, etc.).
                    Each Node has a Node ID.
                </td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Node ID</td>
                <td colspan="" rowspan="">
                    An ID uniquely identifying a node within its corresponding context. If a globally unique ID is desired, an architecture should be used using a universally accepted
                    ID scheme.
                </td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Parameter</td>
                <td colspan="" rowspan="">
                    Readable and/or writable property on a node/device. The XEP xep-0000-SN-Concentrators deals with reading and writing parameters
                    on nodes/devices. Fields are not parameters, and parameters are not fields.
                </td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Peak Value</td>
                <td colspan="" rowspan="">A maximum or minimum value during a given period.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Precision</td>
                <td colspan="" rowspan="">
                    In physics, precision determines the number of digits of precision. In sensor networks however, this definition is not easily applicable. Instead, precision
                    determines, for example, the number of decimals of precision, or power of precision. Example: 123.200 MWh contains 3 decimals of precision. All entities parsing and
                    delivering field information in sensor networks should always retain the number of decimals in a message.
                </td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Sensor</td>
                <td colspan="" rowspan="">
                    Device measuring at least one digital value (0 or 1) or analog value (value with precision and physical unit). Examples: Temperature sensor, pressure sensor, etc.
                    Sensor values are reported as fields during read-out. Each sensor has a unique Node ID.
                </td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">SN</td>
                <td colspan="" rowspan="">Sensor Network. A network consisting, but not limited to sensors, where transport and use of sensor data is of primary concern. A sensor network may contain actuators, network applications, monitors, services, etc.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Status Value</td>
                <td colspan="" rowspan="">A value displaying status information about something.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Timestamp</td>
                <td colspan="" rowspan="">Timestamp of value, when the value was sampled or recorded.</td>
            </tr>
			<tr class="body">
				<td colspan="" rowspan="">Token</td>
				<td colspan="" rowspan="">
					A client, device or user can get a token from a provisioning server. These tokens can be included in requests to other entities in the network, so these entities can validate
					access rights with the provisioning server.
				</td>
			</tr>
			<tr class="body">
                <td colspan="" rowspan="">Unit</td>
                <td colspan="" rowspan="">Physical unit of value. Example: MWh, l/s, etc.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Value</td>
                <td colspan="" rowspan="">A field value.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Value Status</td>
                <td colspan="" rowspan="">Status of field value. Contains important status information for Quality of Service purposes. Examples: Ok, Error, Warning, Time Shifted, Missing, Signed, etc.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">Value Type</td>
                <td colspan="" rowspan="">Can be numeric, string, boolean, Date &amp; Time, Time Span or Enumeration.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">WSN</td>
                <td colspan="" rowspan="">Wireless Sensor Network, a sensor network including wireless devices.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">XMPP Client</td>
                <td colspan="" rowspan="">Application connected to an XMPP network, having a JID. Note that sensors, as well as applications requesting sensor data can be XMPP clients.</td>
            </tr>
        </table>
    </div>
    <h2>3.
       <a name="usecases">Use Cases</a></h2>
        <p class="" style="">
            The most basic use case in sensor networks is to read out sensor data from a sensor. However, since protecting end-user integrity and system security is vital, access 
            rights and user privileges have to be imposed on the network.
        </p>
        <p class="" style="">
            To store access rights in all sensors might be very impractical. Not only does it consume memory, it's difficult to maintain track of the current system status, make sure
            all devices have the latest configuration, distribute changes to the configuration, etc.
        </p>
        <p class="" style="">
            Furthermore, most sensors and small devices have very limited possibility to provide a rich user interface. Perhaps all it can do is to provide a small LED and a button,
            useful perhaps for installing the sensor in the network, but not much more.
        </p>
        <p class="" style="">
            As an added complexity, the sensor network operator might not even have access to the XMPP Servers used, and provisioning needs to lie outside of the XMPP Server domains.
        </p>
        <p class="" style="">
            To solve this problem in an efficient manner, an architecture using distributed trusted third parties is proposed. Such third parties would:
        </p>
        <ul class="" style="">
            <li class="" style="">Provide a rich user interface and configurable options to end user or back end systems.</li>
            <li class="" style="">Control friendships (who can communicate with whom).</li>
            <li class="" style="">Control content available for different friends (what can be read by whom).</li>
            <li class="" style="">Control operations accessible by different friends (what can be controlled/configured by whom).</li>
            <li class="" style="">Provide additional interoperability services to nodes in the network (for instance, unit conversion).</li>
        </ul>
        <div class="indent">
      <h3>3.1 <a name="sect-ID0EROAC">Delegating original trust to a Provisioning Server</a></h3>
            <p class="" style="">
                Trust is delegated to a provisioning server by a device, simply by befriending the provisioning server and asking it questions and complying with
                its answers. 
            </p>
            <p class="" style="">
                As an illustrative example, following is a short description of how such a trust relationship can be created in a scenario where the sensor only
                has a single LED and a single button.
            </p>
            <ul class="" style="">
                <li class="" style="">Somebody is installing the sensor, giving it a connection to an XMPP server and a JID, reachable from the provisioning server.</li>
                <li class="" style="">The provisioning server is told to create a friendship request to the new sensor.</li>
                <li class="" style="">The sensor flashes its LED for a given time (for example: 30 seconds).</li>
                <li class="" style="">Viewing the LED, the person installing the sensor presses the button.</li>
                <li class="" style="">Receiving the button press within the given time period, accepts the friendship request. Optionally, the device can give user feedback using the LED.</li>
                <li class="" style="">The device performs a service discovery of the new friend, having been a manually added friend.</li>
                <li class="" style="">If the new friend supports this provisioning extension, further responsibilities are delegated to this device.</li>
                <li class="" style="">As the last step the device asks the provisioning server for a token. This device token is later used in calls to other devices and can be used to check access rights.</li>
            </ul>
            <p class="" style="">
                The following diagram shows the general case:
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/p1Q3YkX.png">
            </p>
            <p class="" style="">
                The successful case can also be illustrated in a sequence diagram, as follows:
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/b5ERBmK.png">
            </p>
            <p class="" style="">
                The following example shows how a device can request a device token from the provisioning server:
            </p>
            <p class="caption"><a name="example-1"></a>Example 1. Requesting a device token</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='get'
       from='device@clayster.com'
       to='provisioning@clayster.com'
       id='13'&gt;
      &lt;getToken xmlns='urn:xmpp:sn:provisioning' deviceId='WatchamacallitDevice1'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='device@clayster.com'
       id='13'&gt;
      &lt;getTokenResponse xmlns='urn:xmpp:sn:provisioning' token='device0001'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
			<p class="" style="">
				The provisioning server must not return tokens that contain white space characters.
			</p>
            <p class="" style="">
                <span class="strong">Note:</span> In many cases, an address to a provisioning server might be preprogrammed during production of the
                device. In these cases, parts of the above procedure may not neccessary. All the client needs to do, if the provisioning server is not available
                in the roster of the device, is to send a subscription request to the provisioning server, to alert the server of the existence of the device,
                and possibly request a device token.
            </p>
            <p class="" style="">
                The following use cases will assume such a trust relationship has been created between the corresponding device and the provisioning server.
            </p>
        </div>
        <div class="indent">
      <h3>3.2 <a name="sect-ID0ESBAE">Friendship request accepted</a></h3>
            <p class="" style="">
                The following diagram displays how a friendship request from an external party can be handled, delegating the responsibility to a trusted third party:
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/OKEWizE.png">
            </p>
            <p class="" style="">
                The communication between the XMPP Device and the Provisioning Server could be as follows:
            </p>
            <p class="caption"><a name="example-2"></a>Example 2. Friendship request accepted</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='get'
       from='device@clayster.com'
       to='provisioning@clayster.com'
       id='1'&gt;
      &lt;isFriend xmlns='urn:xmpp:sn:provisioning' jid='client1@clayster.com'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='device@clayster.com'
       id='1'&gt;
      &lt;isFriendResponse xmlns='urn:xmpp:sn:provisioning' jid='client1@clayster.com' result='true'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                <span class="strong">Note:</span> The provisioning server implicitly understands which two JIDs that are to be checked: The first one is the sender of the message, the second one
                is the JID available in the <span class="strong">jid</span> attribute in the request.
            </p>
            <p class="" style="">
                <span class="strong">Note 2:</span> Any resource information in the JID must be ignored by the provisioning server.
            </p>
        </div>
        <div class="indent">
      <h3>3.3 <a name="sect-ID0E1CAE">Friendship request rejected</a></h3>
            <p class="" style="">
                The following diagram displays a friendship request from an external party being rejected as a result of the trusted third party negating the friendship:
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/0AovLhm.png">
            </p>
            <p class="" style="">
                The communication between the XMPP Device and the Provisioning Server could be as follows:
            </p>
            <p class="caption"><a name="example-3"></a>Example 3. Friendship request rejected</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='get'
       from='device@clayster.com'
       to='provisioning@clayster.com'
       id='2'&gt;
      &lt;isFriend xmlns='urn:xmpp:sn:provisioning' jid='client2@clayster.com'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='device@clayster.com'
       id='2'&gt;
      &lt;isFriendResponse xmlns='urn:xmpp:sn:provisioning' jid='client2@clayster.com' result='false'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
        </div>
        <div class="indent">
      <h3>3.4 <a name="sect-ID0ESDAE">Unfriending existing friends</a></h3>
            <p class="" style="">
                If the provisioning server decides that two friends in the network should no longer be friends and communicate with each other, it simply sends a message to
                at least one of the friends as follows:
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/cFkG5oM.png">
            </p>
            <p class="" style="">
                The provisioning server should only send such messages to clients that have previously asked the provisioning server if friendship requests should be accepted or not.
            </p>
            <p class="" style="">
                <span class="strong">Note:</span> The device should only honor such messages, if the sender is the trusted third party. Such messages received from other entities not trusted should
                be silently ignored.
            </p>

            <p class="caption"><a name="example-4"></a>Example 4. Unfriending existing friend</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;message from='provisioning@clayster.com'
            to='device@clayster.com'&gt;
      &lt;unfriend xmlns='urn:xmpp:sn:provisioning' jid='client2@clayster.com'/&gt;
   &lt;/message&gt;
            </pre>
      </div>
        </div>
        <div class="indent">
      <h3>3.5 <a name="sect-ID0EREAE">Recommending friendships</a></h3>
            <p class="" style="">
                The provisioning server can, apart from accepting new friendships and rejecting old friendships, also recommend new friendships. In this case, the provisioning server
                simply sends a message to one or both of the soon to be friends, as follows:
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/YKQndsi.png">
            </p>
            <p class="caption"><a name="example-5"></a>Example 5. Recommending friendships</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;message from='provisioning@clayster.com'
            to='device@clayster.com'&gt;
      &lt;friend xmlns='urn:xmpp:sn:provisioning' jid='client2@clayster.com'/&gt;
   &lt;/message&gt;
            </pre>
      </div>
            <p class="" style="">
                Note that the receptor can still ask the provisioning server if it can form a friendship with the suggested friend, using the <span class="strong">isFriend</span> command.
            </p>
        </div>
        <div class="indent">
      <h3>3.6 <a name="sect-ID0EMFAE">Rejecting read-outs</a></h3>
            <p class="" style="">
                An important use case for provisioning in sensor networks is who gets to read out sensor data from which sensors. This use case details how communication with a
                provisioning server can help the device determine if a client has sufficient access rights to read the values of the device.
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/yWPVD44.png">
            </p>
            <p class="" style="">
                <span class="strong">Note:</span> This use case is an extension of the use case 'Read-out rejected' in the XEP <a href="xep-0000-SN-SensorData.html">xep-0000-SN-SensorData</a>.
            </p>
            <p class="" style="">
                The following example shows the communication first between the client and the device, then the device and the provisioning server, and last between the device and the client:
            </p>
            <p class="caption"><a name="example-6"></a>Example 6. Rejecting read-outs</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='get'
       from='master@clayster.com'
       to='device@clayster.com'
       id='3'&gt;
      &lt;req xmlns='urn:xmpp:sn' momentary='true' serviceToken='service0001' userToken='user0001' seqnr='1'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='get'
       from='device@clayster.com'
       to='provisioning@clayster.com'
       id='4'&gt;
      &lt;canRead xmlns='urn:xmpp:sn:provisioning' jid='master@clayster.com' serviceToken='service0001' userToken='user0001' momentary='true'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='device@clayster.com'
       id='4'&gt;
      &lt;canReadResponse xmlns='urn:xmpp:sn:provisioning' jid='master@clayster.com' momentary='true' result='false'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='device@clayster.com'
       to='master@clayster.com'
       id='3'&gt;
      &lt;rejected xmlns='urn:xmpp:sn' seqnr='1'&gt;
         &lt;error&gt;Access denied.&lt;/error&gt;
      &lt;/rejected&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                Note that the provisioning server responds with a <span class="strong">canReadResponse</span> element, with the same content as the <span class="strong">canRead</span> element in the request.
            </p>
        </div>
        <div class="indent">
      <h3>3.7 <a name="sect-ID0EXGAE">Restricting nodes during read-out</a></h3>
            <p class="" style="">
                In case the device handles multiple nodes that can be read, the provisioning server has the possibility to grant read-out, but to limit the nodes that can be read out.
                The provisioning server does this by returning the list of nodes that can be read.
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/niZ6smb.png">
            </p>
            <p class="" style="">
                <span class="strong">Note:</span> This use case is an extension of the use case 'Read-out of multiple devices' in the XEP <a href="xep-0000-SN-SensorData.html">xep-0000-SN-SensorData</a>.
            </p>
            <p class="" style="">
                <span class="strong">Note 2:</span> If the server responds, but without specifying a list of nodes, the device can assume that all nodes available in the original request are allowed
                to be read. If no nodes in the request are allowed to be read, the provisioning server must respond with a result='false', so the device can reject the read-out request.
            </p>
            <p class="" style="">
                The following example shows the communication first between the client and the device, then the device and the provisioning server, and last between the device and the client:
            </p>

            <p class="caption"><a name="example-7"></a>Example 7. Restricting nodes during read-out</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='get'
       from='master@clayster.com'
       to='device@clayster.com'
       id='5'&gt;
      &lt;req xmlns='urn:xmpp:sn' momentary='true' serviceToken='service0001' userToken='user0001' seqnr='2'&gt;
         &lt;node nodeId='Device02'/&gt;
         &lt;node nodeId='Device03'/&gt;
      &lt;/req&gt;
   &lt;/iq&gt;
   
   &lt;iq type='get'
       from='device@clayster.com'
       to='provisioning@clayster.com'
       id='6'&gt;
      &lt;canRead xmlns='urn:xmpp:sn:provisioning' jid='master@clayster.com' momentary='true' serviceToken='service0001' userToken='user0001'&gt;
         &lt;node nodeId='Device02'/&gt;
         &lt;node nodeId='Device03'/&gt;
      &lt;/canRead&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='device@clayster.com'
       id='6'&gt;
      &lt;canReadResponse xmlns='urn:xmpp:sn:provisioning' jid='master@clayster.com' momentary='true' result='true'&gt;
         &lt;node nodeId='Device02'/&gt;
      &lt;/canReadResponse&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='device@clayster.com'
       to='master@clayster.com'
       id='5'&gt;
      &lt;accepted xmlns='urn:xmpp:sn' seqnr='2'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                Note that the provisioning server responds with a <span class="strong">canReadResponse</span> element, similar to the <span class="strong">canRead</span> element in the request, except 
                only the nodes allowed to be read are read. The device must only permit read-out of nodes listed in the response from the provisioning server. Other nodes available 
                in the request should be ignored.
            </p>
        </div>
        <div class="indent">
      <h3>3.8 <a name="sect-ID0EJIAE">Restricting fields during read-out</a></h3>
            <p class="" style="">
                In case the provisioning server wants to limit the fields a device can send to a client, the provisioning server has the possibility to grant read-out, but 
                list a set of fields the device is allowed to send to the corresponding client.
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/niZ6smb.png">
            </p>
            <p class="" style="">
                <span class="strong">Note:</span> If the server responds, but without specifying a list of field names, the device can assume that all fields available in the original request are allowed
                to be sent. If no fields in the request are allowed to be sent, the provisioning server must respond with a result='false', so the device can reject the read-out request.
            </p>
            <p class="" style="">
                The following example shows the communication first between the client and the device, then the device and the provisioning server, and last between the device and the client:
            </p>

            <p class="caption"><a name="example-8"></a>Example 8. Restricting fields during read-out</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='get'
       from='master@clayster.com'
       to='device@clayster.com'
       id='7'&gt;
      &lt;req xmlns='urn:xmpp:sn' momentary='true' serviceToken='service0001' userToken='user0001' seqnr='3'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='get'
       from='device@clayster.com'
       to='provisioning@clayster.com'
       id='8'&gt;
      &lt;canRead xmlns='urn:xmpp:sn:provisioning' jid='master@clayster.com' momentary='true' serviceToken='service0001' userToken='user0001'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='device@clayster.com'
       id='8'&gt;
      &lt;canReadResponse xmlns='urn:xmpp:sn:provisioning' jid='master@clayster.com' momentary='true' result='true'&gt;
         &lt;field name='Energy'/&gt;
         &lt;field name='Power'/&gt;
      &lt;/canReadResponse&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='device@clayster.com'
       to='master@clayster.com'
       id='7'&gt;
      &lt;accepted xmlns='urn:xmpp:sn' seqnr='3'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                Note that the provisioning server responds with a <span class="strong">canReadResponse</span> element, similar to the <span class="strong">canRead</span> element in the request, except only 
                the fields allowed to be sent are listed. The client must only send fields having field names in this list.
            </p>
            <p class="" style="">
                Also note, that the provisioning server can return both lists of allowed nodes and allowed field names in the response. In this case, the device must only send allowed fields
                from allowed nodes, and ignore all other fields and/or nodes.
            </p>
        </div>
        <div class="indent">
      <h3>3.9 <a name="sect-ID0EVJAE">Clear cache</a></h3>
            <p class="" style="">
                When the provisioning server updates access rights and user privileges in the system, it will send a <span class="strong">clearCache</span> command to corresponding devices.
                If a device was offline during the change, the provisioning server must send the <span class="strong">clearCache</span> message when the device comes online again. To acknowledge
				the receipt of the command, the client responds with a <span class="strong">clearCacheResponse</span> element. This response message does not contain any information on what was
				done by the client. It simply acknowledges the receipt of the command, to make sure the provisioning server does not resend the clear cache command again.
            </p>
            <p class="" style="">
                <span class="strong">Note:</span> The <span class="strong">clearCache</span> command does not include information on what has been changed, so the device needs to clear the entire cache. This
                to avoid complexities in making sure updates made to the provisioning rules works in all cases, and to minimize complexity in the implementation of the protocol on the sensor side.
                It is also not deemed to decrease network performance, since changing provisioning rules for a device is an exceptional event and therefore does not affect performance during
                normal operation.
            </p>

            <p class="caption"><a name="example-9"></a>Example 9. Clear cache</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='get'
       from='device@clayster.com'
       to='provisioning@clayster.com'
       id='17'&gt;
      &lt;clearCache xmlns='urn:xmpp:sn:provisioning'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='device@clayster.com'
       id='17'&gt;
      &lt;clearCacheResponse xmlns='urn:xmpp:sn:provisioning'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
        </div>
        <div class="indent">
      <h3>3.10 <a name="sect-ID0ERKAE">Getting a service token</a></h3>
            <p class="" style="">
                A service requesting provisioning assistance, needs to retrieve a service token from the provisioning server. The following example shows how this can be done.
            </p>
            <p class="caption"><a name="example-10"></a>Example 10. Requesting a service token</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='get'
       from='service@clayster.com'
       to='provisioning@clayster.com'
       id='14'&gt;
      &lt;getToken xmlns='urn:xmpp:sn:provisioning' serviceId='WatchamacallitService1'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='service@clayster.com'
       id='14'&gt;
      &lt;getTokenResponse xmlns='urn:xmpp:sn:provisioning' token='service0001'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
        </div>
        <div class="indent">
      <h3>3.11 <a name="sect-ID0E4KAE">User access to service</a></h3>
            <p class="" style="">
                Provisioning in sensor networks also requires control of user access to different services in the network. This use case shows how service access rights are controlled using
                a trusted provisioning server.
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/l6x666H.png">
            </p>
            <p class="" style="">
                First, the user connects to the service in some way. This can be done using XMPP, HTTP, HTTPS or some other means. The service need to extract some form of identifying
                credentials from the user, and provide that to the provisioning server. The provisioning server determines if the client has access rights to the service based on these
                credentials, and also provides the service with a <span class="strong">userToken</span> that the service can use in further communication with the provisioning server regarding
                the user and its privileges.
            </p>
            <p class="" style="">
                The following table lists some different types of credentials that the service can extract from the client:
            </p>
            <div class="indent">
        <p class="caption"><a name="table-3"></a>Table 3: User Credentials</p>
        <table border="1" cellpadding="3" cellspacing="0">
                <tr class="body">
                    <th colspan="" rowspan="">Type</th>
                    <th colspan="" rowspan="">Protocols</th>
                    <th colspan="" rowspan="">Description</th>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">JID</td>
                    <td colspan="" rowspan="">XMPP</td>
                    <td colspan="" rowspan="">Allows provisioning to be done on the JID the user has.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">IP Address</td>
                    <td colspan="" rowspan="">HTTP, HTTPS</td>
                    <td colspan="" rowspan="">Allows provisioning to be done on IP address or IP-ranges for instance.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">Host Name</td>
                    <td colspan="" rowspan="">HTTP, HTTPS with DNS</td>
                    <td colspan="" rowspan="">If the service has access to the client host name, for instance in an intra network, this can be used for provisioning.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">X.509 Certificate</td>
                    <td colspan="" rowspan="">HTTPS</td>
                    <td colspan="" rowspan="">If the client provides a client certificate, such a certificate can be used to provide provisioning.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">X.509 Certificate Thumbprint</td>
                    <td colspan="" rowspan="">HTTPS</td>
                    <td colspan="" rowspan="">The client can also choose to validate the certificate itself and only send the certificate thumbprint to the provisioning server. Even though this
                    provides somewhat lesser security than providing the entire certificate, it might be an option to distribute certificate validation checks across the network
                    to lower the work load on the provisioning server.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">User Name</td>
                    <td colspan="" rowspan="">HTTP, HTTPS, XMPP</td>
                    <td colspan="" rowspan="">If authenticated HTTP(S) access is implemented, the service can provide the user name as credentials. XMPP based clients can use
                    information in the roster to provide user name information to the provisioning server.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">Geolocation</td>
                    <td colspan="" rowspan="">HTML5 over HTTP(S), XMPP</td>
                    <td colspan="" rowspan="">If the geographic location (longitude &amp; latitude) of the user client is known, it can be used. HTML 5 provides mechanism whereby the location
                    of the client can be fetched. <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0080.html">User Geolocation</a></span>  [<a href="#nt-ID0EYPAE">6</a>] provides a mechanism whereby client location can be obtained over XMPP.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">SSO Token</td>
                    <td colspan="" rowspan="">Intranet</td>
                    <td colspan="" rowspan="">If a single sign on token is available, such a token could be provided as credentials.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">Protocol</td>
                    <td colspan="" rowspan="">Any</td>
                    <td colspan="" rowspan="">Connection protocol used to connect to the service.</td>
                </tr>
            </table>
      </div>
            <p class="" style="">
                The provisioning server receives these credentials, and decides if the user should have access to the service or not, based on rules configured in the provisioning service.
                If the user is granted access, a <span class="strong">userToken</span> is generated and returned to the service. This token
            </p>
            <p class="" style="">
                Now, the service can determine if this access grant is sufficient or not. It can require the user to login into the service first. If so, the service should provide the provisioning
                server with the user name used during login, when logged in.
            </p>
            <p class="caption"><a name="example-11"></a>Example 11. User access to service</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;!-- user connects to service --&gt;
   
   &lt;iq type='get'
       from='service@clayster.com'
       to='provisioning@clayster.com'
       id='9'&gt;
      &lt;canAccess xmlns='urn:xmpp:sn:provisioning' serviceToken='service0001'&gt;
          &lt;credentials type='IpAddress' value='10.0.0.1'/&gt;
          &lt;credentials type='Longitude' value='123.45'/&gt;
          &lt;credentials type='Latitude' value='67.89'/&gt;
      &lt;/canAccess&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='service@clayster.com'
       id='9'&gt;
      &lt;canAccessResponse xmlns='urn:xmpp:sn:provisioning' userToken='user0001' result='true'/&gt;
   &lt;/iq&gt;
 
   &lt;!-- user performs login into service --&gt;
 
   &lt;message from='service@clayster.com'
            to='provisioning@clayster.com'&gt;
      &lt;userLoggedIn xmlns='urn:xmpp:sn:provisioning' serviceToken='service0001' userToken='user0001' userName='Kermit' /&gt;
   &lt;/message&gt;
   
   &lt;!-- user continues interacting with service --&gt;
            </pre>
      </div>
        </div>
        <div class="indent">
      <h3>3.12 <a name="sect-ID0EORAE">User privileges in service</a></h3>
            <p class="" style="">
                When a user has been given access to a service, and properly been identified, the service can ask the provisioning service for detailed user privileges to control
                different aspects of the service. This can be done using the <span class="strong">hasPrivilege</span> command. Here, the service sends its <span class="strong">serviceToken</span> and
                the <span class="strong">userToken</span> earlier received when being granted access to the service. Furthermore a <span class="strong">privilegeId</span> has to be provided.
            </p>
            <p class="" style="">
                A <span class="strong">Privilege ID</span> is a string composed of one or a sequence of parts, delimited by period characters. The Privilege IDs form a tree of privileges, 
                using an invisible, but common, root privilege.
            </p>
            <p class="" style="">
                The following table suggests some examples of Privilge IDs, with suggestive descriptions. (Only used as an example.)
            </p>
            <div class="indent">
        <p class="caption"><a name="table-4"></a>Table 4: Privilege ID examples</p>
        <table border="1" cellpadding="3" cellspacing="0">
                <tr class="body">
                    <th colspan="" rowspan="">Privilege ID</th>
                    <th colspan="" rowspan="">Description</th>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">Databases.Energy.Select</td>
                    <td colspan="" rowspan="">Gives the user the rights to select data from the Energy database.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">Databases.Energy.Insert</td>
                    <td colspan="" rowspan="">Gives the user the rights to insert data into the Energy database.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">Databases.Energy.Delete</td>
                    <td colspan="" rowspan="">Gives the user the rights to delete data from the Energy database.</td>
                </tr>
            </table>
      </div>
            <p class="" style="">
                <span class="strong">Note:</span> Note that privilege IDs are local to the service. Different services are allowed to use similar or same Privilege IDs, in different contexts and
                with different meanings. The provisioning server must separate Privilege IDs from different services.
            </p>
            <p class="" style="">
                The client must always provide full Privilege IDs to the provisioning server. The provisioning server however, can grant partial privilege IDs, pointing to parent
                privilege nodes to a user or a role object, granting a user a specific role. If granting a parent privilege ID to a user or role, this is interpreted as
                giving the corresponding user or role the privileges of the entire sub-tree defined by the parent privilege ID.
            </p>
            <p class="" style="">
                If additional control over privileges is desired, negative privileges can be assigned to the user or role. Granted or explicitly rejected privileges are specified in a 
                sequential list of full or partial privilege IDs. This list is then processed sequentially to determine if a privilege is granted or not.
            </p>
            <p class="" style="">
                Example: Consider the privileges above. Give a user or its corresponding role the following privileges in a sequential list:
            </p>
            <ul class="" style="">
                <li class="" style="">Exclude: Databases.Energy.Delete</li>
                <li class="" style="">Include: Databases.Energy</li>
            </ul>
            <p class="" style="">
                This would give the user rights to select and insert data, but not to delete data from the Energy database.
            </p>
            <p class="" style="">
                <span class="strong">Note:</span> Care should be taken when constructing Privilege IDs, so they do not include variable data that potentially can create an infinite amount of
                privilege IDs. For example: Do not include user names, sensor IDs, etc., in privilege IDs, as the number of such entities cannot be estimated or is scalable beforehand.
            </p>
            <p class="" style="">
                The following diagram shows an example of how a service asks permission from a provisioning server before an action is taken:
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/ri6qQ7X.png">
            </p>
            <p class="caption"><a name="example-12"></a>Example 12. User privileges in service</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;!-- user wants to perform action --&gt;
   
   &lt;iq type='get'
       from='service@clayster.com'
       to='provisioning@clayster.com'
       id='10'&gt;
      &lt;hasPrivilege xmlns='urn:xmpp:sn:provisioning' serviceToken='service0001' userToken='user0001' privilegeId='Sensors.View'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='service@clayster.com'
       id='10'&gt;
      &lt;hasPrivilegeResponse xmlns='urn:xmpp:sn:provisioning' result='true'/&gt;
   &lt;/iq&gt;
 
   &lt;!-- user performs action --&gt;
            </pre>
      </div>
        </div>
        <div class="indent">
      <h3>3.13 <a name="sect-ID0EVVAE">Download all user privileges</a></h3>
            <p class="" style="">
                To improve performance, services can download the entire set of user privileges, and perform privilege checks internally. The following diagram displays
                how the above two use cases could be handled in such a case:
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/gHrLZx8.png">
            </p>
            <p class="" style="">
                <span class="strong">Note:</span> When downloading privileges using this command, a sequential list of full or partial privilege IDs will be returned together with the
                corresponding include or exclude flags. The above mentioned algorithm of determining user privileges must be implemented by the service, if this method is
                to be used.
            </p>
            <p class="caption"><a name="example-13"></a>Example 13. Download all user privileges</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;!-- user connects to service --&gt;
   
   &lt;iq type='get'
       from='service@clayster.com'
       to='provisioning@clayster.com'
       id='11'&gt;
      &lt;canAccess xmlns='urn:xmpp:sn:provisioning' serviceToken='service0001'&gt;
          &lt;credentials type='IpAddress' value='10.0.0.1'/&gt;
          &lt;credentials type='Longitude' value='123.45'/&gt;
          &lt;credentials type='Latitude' value='67.89'/&gt;
      &lt;/canAccess&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='service@clayster.com'
       id='11'&gt;
      &lt;canAccessResponse xmlns='urn:xmpp:sn:provisioning' userToken='user0001' result='true'/&gt;
   &lt;/iq&gt;
 
   &lt;!-- user performs login into service --&gt;
 
   &lt;message from='service@clayster.com'
            to='provisioning@clayster.com'&gt;
      &lt;userLoggedIn xmlns='urn:xmpp:sn:provisioning' serviceToken='service0001' userToken='user0001' userName='Kermit' /&gt;
   &lt;/message&gt;
   
   &lt;iq type='get'
       from='service@clayster.com'
       to='provisioning@clayster.com'
       id='12'&gt;
      &lt;downloadPrivileges xmlns='urn:xmpp:sn:provisioning' serviceToken='service0001' userToken='user0001'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='service@clayster.com'
       id='12'&gt;
       &lt;privileges&gt;
           &lt;exclude id='Sensors.Delete'/&gt;
           &lt;include id='Sensors'/&gt;
       &lt;/privileges&gt;
   &lt;/iq&gt;
 
   &lt;!-- user performs actions without interaction with the provisioning server --&gt;
            </pre>
      </div>
        </div>
        <div class="indent">
      <h3>3.14 <a name="sect-ID0EQWAE">Delegating Secondary Trust</a></h3>
            <p class="" style="">
                The <span class="strong">isFriendResponse</span> element returned by the provisioning server contains an attribute <span class="strong">secondaryTrustAllowed</span> that is by default
                set to false. If the provisioning server has no problem with allowing multiple trust to be delegated by devices in the network, it can choose to set this
                attribute to true in the response. If true, the device knows it has the right to add its own friends, or to add secondary trust relationships.
            </p>
            <p class="" style="">
                The following diagram continues with the example given above, of how a sensor with a limited user interface, can allow to manually add new friends, including new 
                trust relationships using a single LED and a button. 
            </p>
            <p class="" style="">
                <img alt="" src="http://i.imgur.com/iz8gSR0.png">
            </p>
        </div>
		<div class="indent">
      <h3>3.15 <a name="sect-ID0EKXAE">Multiple tokens</a></h3>
			<p class="" style="">
				When multiple trust is used, the entity (client, user, service, etc.) has one token from each provisioning server. However, when sending a token to a third party,
				the sender does not know what provisioning server(s) the third party uses to check access rights and user privileges. Therefore, the client must send all tokens, separated
				by a space.
			</p>
			<p class="" style="">
				When a provisioning server receives a request containing multiple tokens, the most forgiving response must be returned.
			</p>
			<p class="caption"><a name="example-14"></a>Example 14. Readout request using multiple tokens</p>
      <div class="indent">
        <pre class="prettyprint">
				
   &lt;iq type='get'
       from='master@clayster.com'
       to='device@clayster.com'
       id='15'&gt;
      &lt;req xmlns='urn:xmpp:sn' momentary='true' serviceToken='service0001 servicio0001' userToken='user0001' seqnr='4'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='get'
       from='device@clayster.com'
       to='provisioning@clayster.com'
       id='16'&gt;
      &lt;canRead xmlns='urn:xmpp:sn:provisioning' jid='master@clayster.com' serviceToken='service0001 servicio0001' userToken='user0001' momentary='true'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='provisioning@clayster.com'
       to='device@clayster.com'
       id='16'&gt;
      &lt;canReadResponse xmlns='urn:xmpp:sn:provisioning' jid='master@clayster.com' momentary='true' result='true'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='device@clayster.com'
       to='master@clayster.com'
       id='15'&gt;
      &lt;accepted xmlns='urn:xmpp:sn' seqnr='4'/&gt;
   &lt;/iq&gt;
			</pre>
      </div>
		</div>
    <h2>4.
       <a name="support">Determining Support</a></h2>
        <p class="" style="">If an entity supports the protocol specified herein, it MUST advertise that fact by returning a feature of "urn:xmpp:sn:provisioning" in response to <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0030.html">Service Discovery</a></span>  [<a href="#nt-ID0EJYAE">7</a>] information requests.</p>
        <p class="caption"><a name="example-15"></a>Example 15. Service discovery information request</p>
    <div class="indent">
      <pre class="prettyprint">
            
&lt;iq type='get'
    from='device@clayster.com'
    to='provisioning@clayster.com'
    id='disco1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
        </pre>
    </div>
        <p class="caption"><a name="example-16"></a>Example 16. Service discovery information response</p>
    <div class="indent">
      <pre class="prettyprint">
            
&lt;iq type='result'
    from='provisioning@clayster.com'
    to='device@clayster.com'
    id='disco1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    ...
    &lt;feature var='urn:xmpp:sn:provisioning'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
        </pre>
    </div>
        <p class="" style="">
            In order for an application to determine whether an entity supports this protocol, where possible it SHOULD use the dynamic, presence-based profile of service discovery defined
            in <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0115.html">Entity Capabilities</a></span>  [<a href="#nt-ID0EAZAE">8</a>]. However, if an application has not received entity capabilities information from an entity, it SHOULD use explicit service discovery instead.
        </p>
    <h2>5.
       <a name="impl">Implementation Notes</a></h2>
        <div class="indent">
      <h3>5.1 <a name="sect-ID0EMZAE">Caching and cache time</a></h3>
            <p class="" style="">
                To minimize network traffic, and optimize response time, devices should cache access rights and user privileges provided by the provisioning server. If memory is limited,
                items in the cache should be ordered by last access, and items with the oldest last access timestamp should be removed first. A safety valve can optionally be implemented as well,
                removing unused cache items after a certain age, even if memory is available.
            </p>
            <p class="" style="">
                The device can assume that access rights and user privileges on the provisioning server do not change over time, unless the provisioning server says so.
            </p>
            <p class="" style="">
                The provisioning server on the other hand, must keep track of when a device is online and offline, and clear the cache of the device if changes are made that affects the device.
                If the device was offline when those changes occurred, the provisioning server must send the clear cache command as soon as the device comes online again.
            </p>
            <p class="" style="">
                When creating a new trust relationship, the device should always clear its cache, if it contains information from before.
            </p>
            <p class="" style="">
                To minimize stress of the provisioning server during synchronous sensor start up, for instance after a power failure, all clients should aim to persist its cache if possible. Clients
                not persisting its cache may produce too much stress on the provisioning server on start-up, practically removing it from the network.
            </p>
        </div>
        <div class="indent">
      <h3>5.2 <a name="sect-ID0EF1AE">Working with multiple provisioning servers</a></h3>
            <p class="" style="">
                When working with multiple provisioning servers, there are some things that should be considered:
            </p>
            <ul class="" style="">
                <li class="" style="">
                    When a device requests information from the provisioning servers, this can be done in a parallel fashion. Even though the provisioning servers
                    were added in a sequential fashion, there is no order or priority between the servers.
                </li>
                <li class="" style="">
                    When receiving different responses from different servers, with regards to access rights, privileges, relationships, etc.,
                    the union of rights, or the most forgiving or most accepting response should be used. If one of the servers grant a privilege, the privilege is assumed
                    to exist. If one of the servers grant a friendship request, the friendship request should be granted, etc. Most probably, different servers will manage
                    different subsets of entities on the network, and when they receive questions about unrecognized devices, they will simply deny access.
                </li>
                <li class="" style="">
                    If a provisioning server requires total control of the network, it should not allow secondary trust relationships. However, if such a server enters a network
                    and there exist previous provisioning servers (i.e. they accept secondary trust relationships), more trust relationships are assumed to be acceptable.
                </li>
                <li class="" style="">
                    Even though examples in this document only list a secondary trust relationship, there is no such limit. There may exist many different trust relationships in a network
                    or for a given device.
                </li>
            </ul>
        </div>
        <div class="indent">
      <h3>5.3 <a name="sect-ID0ED2AE">Automatic aggregation of services, users and privileges</a></h3>
            <p class="" style="">
                One important design consideration when implementing a provisioning server is how to handle new services, users and privileges. One option might be to automatically
                ignore anything not recognized. Another option might be to dynamically add new services, user names and privileges to internal data sources, making it easier to manage
                new types of services dynamically. However, adding such items automatically might also make such data sources grow beyond control.
            </p>
        </div>
        <div class="indent">
      <h3>5.4 <a name="sect-ID0EM2AE">Reading devices from large subsystems</a></h3>
            <p class="" style="">
                All examples in this document have been simplified examples where a few devices containing a few fields have been read. However, in many cases large subsystems with
                very many sensors containing many fields have to be read, as is documented in <a href="xep-0000-SN-Concentrators.html">xep-0000-SN-Concentrators.html</a>
                 [<a href="#nt-ID0EX2AE">9</a>]. In such cases, a node may have to be specified using two or perhaps
                even three ID's: a <span class="strong">sourceId</span> identifying the data source controlling the device, a possible <span class="strong">cacheType</span> narrowing down the search to
                a specific kind of node, and the common <span class="strong">nodeId</span>. For more information about this, see <a href="xep-0000-SN-Concentrators.html">xep-0000-SN-Concentrators.html</a>.
            </p>
            <p class="" style="">
                <span class="strong">Note:</span> For cases where the <span class="strong">nodeId</span> is sufficient to uniquely identify the node, it is sufficient to provide this attribute in the request.
                If there is ambiguity in the request, the receptor must treat the request as a request with a set of nodes, all with the corresponding <span class="strong">nodeId</span> as requested.
            </p>
        </div>
		<div class="indent">
      <h3>5.5 <a name="sect-ID0ER3AE">Different types of tokens</a></h3>
			<p class="" style="">
				A small note regarding the use of different tokens. A service can get a <span class="strong">Service Token</span>, a device a <span class="strong">Device Token</span> and a user
				a <span class="strong">User Token</span>. When delegating these tokens to third parties, a service sends its <span class="strong">Service Token</span>. But, if the service does this
				within the context of a user action, the service sends both its <span class="strong">Service Token</span> and the users <span class="strong">User Token</span>. The same with a device.
				If a device delegates its token to a third party, it sends its <span class="strong">Device Token</span>. But if the device performs the action in the context of a user action,
				the device sends both its <span class="strong">Device Token</span> as well as its <span class="strong">User Token</span>.
			</p>
		</div>
    <h2>6.
       <a name="security">Security Considerations</a></h2>
        <p class="" style="">
            Delegating trust to a third party may create a weak link in the overall security of a sensor network. Therefore, it's vitally important that the following be adhered to:
        </p>
        <ul class="" style="">
            <li class="" style="">
                Trust should only be delegated in a secure way. Once delegated, it should be able to lock this trust so it cannot be changed without reverting the device to
                factory default settings. Such a locked delegation mode can be likened with a production mode, where vital configuration parameters should not be able to be changed.
            </li>
            <li class="" style="">
                If allowing installation using a LED, as above, make sure the LED does not light up for a long time, limiting the window of access where the sensor can be linked to a
                provisioning server.
            </li>
            <li class="" style="">
                Provisioning servers should be monitored during operation, since it provides a vital link in the operation of the network.
            </li>
            <li class="" style="">
                Multiple provisioning servers could be allowed, for redundancy or for scalability. This specification does not limit the number of provisioning servers used in a network,
                not used by a device. Examples use only one provisioning server for simplicity.
            </li>
            <li class="" style="">
                Generally, take care what kind of provisioning servers you allow in a network.
            </li>
        </ul>
    <h2>7.
       <a name="iana">IANA Considerations</a></h2>
        <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-ID0E55AE">10</a>].</p>
    <h2>8.
       <a name="registrar">XMPP Registrar Considerations</a></h2>
        <p class="" style="">REQUIRED.</p>
        
    <h2>9.
       <a name="schema">XML Schema</a></h2>
        <p class="caption">
    </p>
    <div class="indent">
      <pre class="prettyprint">
            
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:xmpp:sn:provisioning'
    xmlns='urn:xmpp:sn:provisioning'
    xmlns:sn='urn:xmpp:sn'
    elementFormDefault='qualified'&gt;
 
    &lt;xs:import namespace='urn:xmpp:sn'/&gt;
 
    &lt;xs:element name='getToken' type='GetToken'/&gt;
    &lt;xs:element name='getTokenResponse' type='GetTokenResponse'/&gt;
 
    &lt;xs:complexType name='GetToken'&gt;
        &lt;xs:attribute name='deviceId' type='xs:string' use='optional'/&gt;
        &lt;xs:attribute name='serviceId' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='GetTokenResponse'&gt;
        &lt;xs:attribute name='token' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:element name='isFriend' type='Friend'/&gt;
    &lt;xs:element name='isFriendResponse' type='FriendResponse'/&gt;
    &lt;xs:element name='unfriend' type='Friend'/&gt;
    &lt;xs:element name='Friend' type='Friend'/&gt;
 
    &lt;xs:complexType name='Friend'&gt;
        &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='FriendResponse'&gt;
        &lt;xs:complexContent&gt;
            &lt;xs:extension base='Friend'&gt;
                &lt;xs:attribute name='result' type='xs:boolean' use='required'/&gt;
                &lt;xs:attribute name='secondaryTrustAllowed' type='xs:boolean' use='optional' default='false'/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:complexContent&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:element name='canRead' type='CanRead'/&gt;
    &lt;xs:element name='canReadResponse' type='CanReadResponse'/&gt;
 
    &lt;xs:complexType name='CanReadBase' abstract='true'&gt;
        &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
            &lt;xs:element name='node'&gt;
                &lt;xs:complexType&gt;
                    &lt;xs:attribute name='nodeId' type='xs:string' use='required'/&gt;
                    &lt;xs:attribute name='sourceId' type='xs:string' use='optional'/&gt;
                    &lt;xs:attribute name='cacheType' type='xs:string' use='optional'/&gt;
                &lt;/xs:complexType&gt;
            &lt;/xs:element&gt;
            &lt;xs:element name='field'&gt;
                &lt;xs:complexType&gt;
                    &lt;xs:attribute name='name' type='xs:string' use='required'/&gt;
                &lt;/xs:complexType&gt;
            &lt;/xs:element&gt;
        &lt;/xs:choice&gt;
        &lt;xs:attributeGroup ref='sn:fieldTypes'/&gt;
        &lt;xs:attribute name='all' type='xs:boolean' use='optional' default='false'/&gt;
        &lt;xs:attribute name='historical' type='xs:boolean' use='optional' default='false'/&gt;
        &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='CanRead'&gt;
        &lt;xs:complexContent&gt;
            &lt;xs:extension base='CanReadBase'&gt;
                &lt;xs:attribute name='token' type='xs:string' use='optional'/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:complexContent&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='CanReadResponse'&gt;
        &lt;xs:complexContent&gt;
            &lt;xs:extension base='CanReadBase'&gt;
                &lt;xs:attribute name='result' type='xs:boolean' use='required'/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:complexContent&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:element name='clearCache'&gt;
        &lt;xs:complexType/&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:element name='clearCacheResponse'&gt;
        &lt;xs:complexType/&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:element name='canAccess'&gt;
        &lt;xs:complexType&gt;
            &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
                &lt;xs:element name='jid' type='jidCredential'/&gt;
                &lt;xs:element name='ip4' type='ip4Credential'/&gt;
                &lt;xs:element name='ip6' type='ip6Credential'/&gt;
                &lt;xs:element name='hostName' type='hostNameCredential'/&gt;
                &lt;xs:element name='x509Certificate' type='x509CertificateCredential'/&gt;
                &lt;xs:element name='x509CertificateThumbprint' type='x509CertificateThumbprintCredential'/&gt;
                &lt;xs:element name='userName' type='userNameCredential'/&gt;
                &lt;xs:element name='longitude' type='longitudeCredential'/&gt;
                &lt;xs:element name='latitude' type='latitudeCredential'/&gt;
                &lt;xs:element name='sso' type='ssoCredential'/&gt;
                &lt;xs:element name='protocol' type='protocolCredential'/&gt;
            &lt;/xs:choice&gt;
            &lt;xs:attribute name='serviceToken' type='xs:string' use='required'/&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:element name='canAccessResponse'&gt;
        &lt;xs:complexType&gt;
            &lt;xs:attribute name='result' type='xs:boolean' use='required'/&gt;
            &lt;xs:attribute name='userToken' type='xs:string' use='optional'/&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:complexType name='jidCredential'&gt;
        &lt;xs:attribute name='value' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='ip4Credential'&gt;
        &lt;xs:attribute name='value' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='ip6Credential'&gt;
        &lt;xs:attribute name='value' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='hostNameCredential'&gt;
        &lt;xs:attribute name='value' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='x509CertificateCredential'&gt;
        &lt;xs:attribute name='base64' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='x509CertificateThumbprintCredential'&gt;
        &lt;xs:attribute name='base64' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='userNameCredential'&gt;
        &lt;xs:attribute name='value' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='longitudeCredential'&gt;
        &lt;xs:attribute name='value' type='xs:double' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='latitudeCredential'&gt;
        &lt;xs:attribute name='value' type='xs:double' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='ssoCredential'&gt;
        &lt;xs:attribute name='value' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='protocolCredential'&gt;
        &lt;xs:attribute name='value' type='ProtocolName' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:simpleType name='ProtocolName'&gt;
        &lt;xs:restriction base='xs:string'&gt;
            &lt;xs:enumeration value='XMPP'/&gt;
            &lt;xs:enumeration value='HTTP'/&gt;
            &lt;xs:enumeration value='HTTPS'/&gt;
            &lt;xs:enumeration value='TcpSocket'/&gt;
            &lt;xs:enumeration value='UdpSocket'/&gt;
            &lt;xs:enumeration value='Queue'/&gt;
            &lt;xs:enumeration value='Internal'/&gt;
            &lt;xs:enumeration value='Other'/&gt;
        &lt;/xs:restriction&gt;
    &lt;/xs:simpleType&gt;
 
    &lt;xs:element name='userLoggedIn'&gt;
        &lt;xs:complexType&gt;
            &lt;xs:attribute name='serviceToken' type='xs:string' use='required'/&gt;
            &lt;xs:attribute name='userToken' type='xs:string' use='required'/&gt;
            &lt;xs:attribute name='userName' type='xs:string' use='required'/&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:element name='hasPrivilege'&gt;
        &lt;xs:complexType&gt;
            &lt;xs:attribute name='serviceToken' type='xs:string' use='required'/&gt;
            &lt;xs:attribute name='userToken' type='xs:string' use='required'/&gt;
            &lt;xs:attribute name='privilegeId' type='PrivilegeId' use='required'/&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:element name='hasPrivilegeResponse'&gt;
        &lt;xs:complexType&gt;
            &lt;xs:attribute name='result' type='xs:boolean' use='required'/&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:simpleType name='PrivilegeId'&gt;
        &lt;xs:restriction base='xs:string'&gt;
            &lt;xs:pattern value='^[^.]+([.][^.]+)*$'/&gt;
        &lt;/xs:restriction&gt;        
    &lt;/xs:simpleType&gt;
 
    &lt;xs:element name='downloadPrivileges'&gt;
        &lt;xs:complexType&gt;
            &lt;xs:attribute name='serviceToken' type='xs:string' use='required'/&gt;
            &lt;xs:attribute name='userToken' type='xs:string' use='required'/&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:element name='downloadPrivilegesResponse'&gt;
        &lt;xs:complexType&gt;
            &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
                &lt;xs:element name='include' type='Privilege'/&gt;
                &lt;xs:element name='exclude' type='Privilege'/&gt;
            &lt;/xs:choice&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:complexType name='Privilege'&gt;
        &lt;xs:attribute name='id' type='PrivilegeId' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
&lt;/xs:schema&gt;
        </pre>
    </div>
    <h2>10.
       <a name="ack">Acknowledgements</a></h2>
		<p class="" style="">Thanks to Joachim Lindborg and Karin Forsell for all valuable feedback.</p>
	<hr><a name="appendices"></a><h2>Appendices</h2>
    <hr><a name="appendix-docinfo"></a><h3>Appendix A: Document Information</h3>
    <p class="indent">
            Series: <a href="http://xmpp.org/extensions/">XEP</a><br>
            Number: xxxx<br>
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br>
            Status: 
            <a href="http://xmpp.org/extensions/xep-0001.html#states-ProtoXEP">ProtoXEP</a><br>
            Type:
            <a href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br>
            Version: 0.0.3<br>
            Last Updated: 2013-03-18<br>
                Approving Body: <a href="http://xmpp.org/council/">XMPP Council</a><br>Dependencies: XMPP Core, XEP-0001, XEP-0030, xep-0000-SN-SensorData<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: NOT_YET_ASSIGNED<br>
            This document in other formats: 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-xxxx.xml">XML</a> 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-xxxx.pdf">PDF</a></p>
    <hr><a name="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3>
    <div class="indent">
      <h3>Peter Waher</h3>
      <p class="indent">
        Email:
        <a href="mailto:peter.waher@clayster.com">peter.waher@clayster.com</a><br>
        JabberID: 
        <a href="xmpp:peter.waher@jabber.org">peter.waher@jabber.org</a><br>
        URI: 
        <a href="http://se.linkedin.com/pub/peter-waher/1a/71b/a29/">http://se.linkedin.com/pub/peter-waher/1a/71b/a29/</a><br></p>
    </div>
    <hr><a name="appendix-legal"></a><h3>Appendix C: Legal Notices</h3>
    <div class="indent">
      <h4>Copyright</h4>This XMPP Extension Protocol is copyright (c) 1999 - 2013 by the XMPP Standards Foundation (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. In no event shall the XMPP Standards Foundation or the authors of this Specification be liable for any claim, damages, or other liability, whether in an action of contract, tort, or otherwise, arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising out of the use or inability to use the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>
                This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which may be found at &lt;<a href="http://www.xmpp.org/extensions/ipr-policy.shtml">http://www.xmpp.org/extensions/ipr-policy.shtml</a>&gt; or obtained by writing to XSF, P.O. Box 1641, Denver, CO 80201 USA).
            </div>
    <hr><a name="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3>
    <p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
    <hr><a name="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3>
    <p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p>
    <p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p>
    <p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p>
    <hr><a name="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3>
    <p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p>
    <hr><a name="appendix-notes"></a><h3>Appendix G: Notes</h3>
    <div class="indent">
      <p><a name="nt-ID0EUE">1</a>. <a href="xep-0000-SN-SensorData.html">xep-0000-SN-SensorData</a></p>
      <p><a name="nt-ID0EXF">2</a>. XEP-0004: Data Forms &lt;<a href="http://xmpp.org/extensions/xep-0004.html">http://xmpp.org/extensions/xep-0004.html</a>&gt;.</p>
      <p><a name="nt-ID0EDG">3</a>. XEP-0122: Data Forms Validation &lt;<a href="http://xmpp.org/extensions/xep-0122.html">http://xmpp.org/extensions/xep-0122.html</a>&gt;.</p>
      <p><a name="nt-ID0EPG">4</a>. XEP-0137: Publishing Stream Initiation Requests &lt;<a href="http://xmpp.org/extensions/xep-0137.html">http://xmpp.org/extensions/xep-0137.html</a>&gt;.</p>
      <p><a name="nt-ID0E2G">5</a>. XEP-0141: Data Forms Layout &lt;<a href="http://xmpp.org/extensions/xep-0141.html">http://xmpp.org/extensions/xep-0141.html</a>&gt;.</p>
      <p><a name="nt-ID0EYPAE">6</a>. XEP-0080: User Geolocation &lt;<a href="http://xmpp.org/extensions/xep-0080.html">http://xmpp.org/extensions/xep-0080.html</a>&gt;.</p>
      <p><a name="nt-ID0EJYAE">7</a>. XEP-0030: Service Discovery &lt;<a href="http://xmpp.org/extensions/xep-0030.html">http://xmpp.org/extensions/xep-0030.html</a>&gt;.</p>
      <p><a name="nt-ID0EAZAE">8</a>. XEP-0115: Entity Capabilities &lt;<a href="http://xmpp.org/extensions/xep-0115.html">http://xmpp.org/extensions/xep-0115.html</a>&gt;.</p>
      <p><a name="nt-ID0EX2AE">9</a>. <a href="xep-0000-SN-Concentrators.html">xep-0000-SN-Concentrators.html</a></p>
      <p><a name="nt-ID0E55AE">10</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
    </div>
    <hr><a name="appendix-revs"></a><h3>Appendix H: Revision History</h3>
    <p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p>
    <div class="indent">
      <h4>Version 0.0.3 (2013-03-18)</h4>
      <div class="indent">
                <p class="" style="">Added information about how to read sensors from large subsystems.</p>
                <p class="" style="">Added friend recommendation message.</p>
                <p class="" style="">Added client/device/service tokens.</p>
             (pwa)
    </div>
      <h4>Version 0.0.2 (2013-03-12)</h4>
      <div class="indent">
                <p class="" style="">Added use cases for service access rights and corresponding user privileges.</p>
             (pwa)
    </div>
      <h4>Version 0.0.1 (2013-03-11)</h4>
      <div class="indent">
                <p class="" style="">First draft.</p>
             (pwa)
    </div>
    </div>
    <hr>
    <p>END</p>
  </body>
</html>