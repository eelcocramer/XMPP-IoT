<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>XEP-xxxx: Internet of Things - Discovery</title>
    <link rel="stylesheet" type="text/css" href="xmpp.css">
    <link href="prettify.css" type="text/css" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico"><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0">
    <meta name="DC.Title" content="Internet of Things - Discovery">
    <meta name="DC.Creator" content="Peter Waher">
    <meta name="DC.Description" content="This specification describes an architecture based on the XMPP protocol whereby Things can be installed and safely discovered by their owners and connected into networks of Things.">
    <meta name="DC.Publisher" content="XMPP Standards Foundation">
    <meta name="DC.Contributor" content="XMPP Extensions Editor">
    <meta name="DC.Date" content="2014-02-18">
    <meta name="DC.Type" content="XMPP Extension Protocol">
    <meta name="DC.Format" content="XHTML">
    <meta name="DC.Identifier" content="XEP-xxxx">
    <meta name="DC.Language" content="en">
    <meta name="DC.Rights" content="This XMPP Extension Protocol is copyright © 1999 - 2013 by the XMPP Standards Foundation (XSF).">
  </head>
  <body onload="prettyPrint()">
    <h1>XEP-xxxx: Internet of Things - Discovery</h1>
    <table>
      <tr valign="top">
        <td><strong>Abstract:</strong></td>
        <td>This specification describes an architecture based on the XMPP protocol whereby Things can be installed and safely discovered by their owners and connected into networks of Things.</td>
      </tr>
      <tr valign="top">
        <td><strong>Author:</strong></td>
        <td>Peter Waher</td>
      </tr>
      <tr valign="top">
        <td><strong>Copyright:</strong></td>
        <td>© 1999 - 2013 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</td>
      </tr>
      <tr valign="top">
        <td><strong>Status:</strong></td>
        <td>ProtoXEP</td>
      </tr>
      <tr valign="top">
        <td><strong>Type:</strong></td>
        <td>Standards Track</td>
      </tr>
      <tr valign="top">
        <td><strong>Version:</strong></td>
        <td>0.0.1</td>
      </tr>
      <tr valign="top">
        <td><strong>Last Updated:</strong></td>
        <td>2014-02-18</td>
      </tr>
    </table>
    <hr>
    <p style="color:red">WARNING: This document has not yet been accepted for consideration or approved in any official manner by the XMPP Standards Foundation, and this document is not yet an XMPP Extension Protocol (XEP). If this document is accepted as a XEP by the XMPP Council, it will be published at &lt;<a href="http://xmpp.org/extensions/">http://xmpp.org/extensions/</a>&gt; and announced on the &lt;standards@xmpp.org&gt; mailing list.</p>
    <hr>
    <h2>Table of Contents</h2>
    <div class="indent">
      <p><br>1.  <a href="#intro">Introduction</a><br>2.  <a href="#glossary">Glossary</a><br>3.  <a href="#usecases">Use Cases</a><br>   
      3.1.  <a href="#sect-ID0EVKAC">Production</a><br>   
      3.2.  <a href="#sect-ID0EXLAC">Installation</a><br>   
      3.3.  <a href="#sect-ID0EAMAC">Finding XMPP Server</a><br>      
      3.3.1.  <a href="#sect-ID0E4MAC">DHCP</a><br>      
      3.3.2.  <a href="#sect-ID0EINAC">DNS Service Discovery and Multicast DNS</a><br>      
      3.3.3.  <a href="#sect-ID0EVNAC">SSDP/UPnP</a><br>   
      3.4.  <a href="#sect-ID0EUOAC">Connection to XMPP Server</a><br>   
      3.5.  <a href="#sect-ID0EOPAC">Finding Thing Registry</a><br>   
      3.6.  <a href="#sect-ID0EUBAE">Registering Thing</a><br>   
      3.7.  <a href="#sect-ID0EQCAE">Register self-owned Thing</a><br>   
      3.8.  <a href="#sect-ID0EBDAE">Register Thing behind Concentrator</a><br>   
      3.9.  <a href="#sect-ID0E1EAE">Claiming Ownership of a Thing</a><br>   
      3.10.  <a href="#sect-ID0EVJAE">Removing Thing from Registry</a><br>   
      3.11.  <a href="#sect-ID0EHLAE">Finding Provisioning Server</a><br>   
      3.12.  <a href="#sect-ID0EIOAE">Delegating Trust</a><br>   
      3.13.  <a href="#sect-ID0E5OAE">Update Meta Information about Thing in Registry</a><br>   
      3.14.  <a href="#sect-ID0EOQAE">Search for Public Things in Registry</a><br>   
      3.15.  <a href="#sect-ID0EU4AE">Unregistering Thing from Registry</a><br>4.  <a href="#support">Determining Support</a><br>5.  <a href="#impl">Implementation Notes</a><br>   
      5.1.  <a href="#tags">Meta Tags</a><br>   
      5.2.  <a href="#sect-ID0EOLAG">Friendships between Things and Registry</a><br>6.  <a href="#security">Security Considerations</a><br>   
      6.1.  <a href="#sect-ID0E3LAG">Hijacking predefined JIDs</a><br>   
      6.2.  <a href="#sect-ID0EFMAG">Hijacking nicknames</a><br>   
      6.3.  <a href="#sect-ID0EOMAG">Hijacking things in public areas</a><br>   
      6.4.  <a href="#sect-ID0E2MAG">Key meta information in searches</a><br>   
      6.5.  <a href="#sect-ID0E5NAG">KEY tag</a><br>   
      6.6.  <a href="#sect-ID0EROAG">Tag name spam</a><br>7.  <a href="#iana">IANA Considerations</a><br>8.  <a href="#registrar">XMPP Registrar Considerations</a><br>9.  <a href="#schema">XML Schema</a><br>10.  <a href="#moreinfo">For more information</a><br>11.  <a href="#ack">Acknowledgements</a></p>
      <p><a href="#appendices">Appendices</a><br>    <a href="#appendix-docinfo">A: Document Information</a><br>    <a href="#appendix-authorinfo">B: Author Information</a><br>    <a href="#appendix-legal">C: Legal Notices</a><br>    <a href="#appendix-xmpp">D: Relation to XMPP</a><br>    <a href="#appendix-discuss">E: Discussion Venue</a><br>    <a href="#appendix-conformance">F: Requirements Conformance</a><br>    <a href="#appendix-notes">G: Notes</a><br>    <a href="#appendix-revs">H: Revision History</a></p>
    </div>
    <hr>
    <h2>1.
       <a name="intro">Introduction</a></h2>
		<p class="" style="">
			When installing massive amounts of Things into public networks care has to be taken to make installation simple, but at the same time secure so that the Things cannot be
			hijacked or hacked, making sure access to the Thing is controlled by the physical owner of the Thing. One of the main problems is how
			to match the characteristics of a Thing, like serial number, manufacturer, model, etc., with information automatically created by the Thing itself, like perhaps its JID, in
			an environment with massive amount of Things without rich user interfaces. Care has also to be taken when specifying rules for access rights and user privileges.
		</p>
        <p class="" style="">
			This document provides a network architecture based on the XMPP protocol that provides a means to safely install, configure, find and connect massive amounts of Things together, and
			at the same time minimizing the risk that Things get hijacked. It also provides information how each individual step in the process can be performed with as little manual intervention
			as possible, aiming where possible at zero-configuration networking. Furthermore, this document specifies how to create a registry that allows simple access to public Things
			without risking their integrity uneccessarily.
		</p>
        <p class="" style="">
            Internet of Things contains many different architectures and use cases. For this reason, the IoT standards have been divided into multiple XEPs according to the following table:
        </p>
        <div class="indent">
      <p class="caption"><a name="table-1"></a>Table 1: Internet of Things XEPs</p>
      <table border="1" cellpadding="3" cellspacing="0">
            <tr class="body">
                <th colspan="" rowspan="">XEP</th>
                <th colspan="" rowspan="">Description</th>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-IoT-BatteryPoweredSensors</td>
                <td colspan="" rowspan="">Defines how to handle the peculiars related to battery powered devices, and other devices intermittently available on the network.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-IoT-Discovery</td>
                <td colspan="" rowspan="">This specification. Defines the peculiars of Thing discovery in Internet of Things. Apart from discovering Things by JID, it also defines how to discover Things based on location, etc.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-IoT-Events</td>
                <td colspan="" rowspan="">Defines how Things send events, how event subscription, hysteresis levels, etc., are configured.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-IoT-Interoperability</td>
                <td colspan="" rowspan="">Defines guidelines for how to achieve interoperability in Internet of Things, publishing interoperability interfaces for different types of devices.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-IoT-Multicast</td>
                <td colspan="" rowspan="">Defines how sensor data can be multicast in efficient ways.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-IoT-PubSub</td>
                <td colspan="" rowspan="">Defines how efficient publication of sensor data can be made in Internet of Things.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">xep-0000-IoT-Chat</td>
                <td colspan="" rowspan="">Defines how human-to-machine interfaces should be constructed using chat messages to be user friendly, automatable and consistent with other IoT extensions and possible underlying architecture.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">XEP-0322</td>
                <td colspan="" rowspan="">
                    Defines how to EXI can be used in XMPP to achieve efficient compression of data. Albeit not a Internet of Things specific XEP, this XEP should be considered
                    in all Internet of Things implementations where memory and packet size is an issue.
                </td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">XEP-0323</td>
                <td colspan="" rowspan="">
                    Provides the underlying architecture, basic operations and data structures for sensor data communication over XMPP networks.
                    It includes a hardware abstraction model, removing any technical detail implemented in underlying technologies. This XEP is used by all other
                    Internet of Things XEPs.
                </td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">XEP-0324</td>
                <td colspan="" rowspan="">Defines how provisioning, the management of access privileges, etc., can be efficiently and easily implemented.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">XEP-0325</td>
                <td colspan="" rowspan="">Defines how to control actuators and other devices in Internet of Things.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">XEP-0326</td>
                <td colspan="" rowspan="">Defines how to handle architectures containing concentrators or servers handling multiple Things.</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">XEP-0331</td>
                <td colspan="" rowspan="">Defines extensions for how color parameters can be handled, based on <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0004.html">Data Forms</a></span>  [<a href="#nt-ID0EWAAC">1</a>]</td>
            </tr>
            <tr class="body">
                <td colspan="" rowspan="">XEP-0336</td>
                <td colspan="" rowspan="">Defines extensions for how dynamic forms can be created, based on <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0004.html">Data Forms</a></span>  [<a href="#nt-ID0ENBAC">2</a>], <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0122.html">Data Forms Validation</a></span>  [<a href="#nt-ID0EZBAC">3</a>], <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0137.html">Publishing Stream Initiation Requests</a></span>  [<a href="#nt-ID0EFCAC">4</a>] and <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0141.html">Data Forms Layout</a></span>  [<a href="#nt-ID0ERCAC">5</a>].</td>
            </tr>
        </table>
    </div>
    <h2>2.
       <a name="glossary">Glossary</a></h2>
        <p class="" style="">The following table lists common terms and corresponding descriptions.</p>
        <div class="indent">
      <dl>
            <di>
                <dt><strong>Actuator</strong></dt>
                <dd>Device containing at least one configurable property or output that can and should be controlled by some other entity or device.</dd>
            </di>
            <di>
                <dt><strong>Authority</strong></dt>
                <dd>Used synonymously with Provisioning Server.</dd>
            </di>
            <di>
                <dt><strong>Computed Value</strong></dt>
                <dd>A value that is computed instead of measured.</dd>
            </di>
            <di>
                <dt><strong>Concentrator</strong></dt>
                <dd>Device managing a set of devices which it publishes on the XMPP network.</dd>
            </di>
            <di>
                <dt><strong>Field</strong></dt>
                <dd>
                    One item of sensor data. Contains information about: Node, Field Name, Value, Precision, Unit, Value Type, Status, Timestamp, Localization information, etc.
                    Fields should be unique within the triple (Node ID, Field Name, Timestamp).
                </dd>
            </di>
            <di>
                <dt><strong>Field Name</strong></dt>
                <dd>Name of a field of sensor data. Examples: Energy, Volume, Flow, Power, etc.</dd>
            </di>
            <di>
                <dt><strong>Field Type</strong></dt>
                <dd>What type of value the field represents. Examples: Momentary Value, Status Value, Identification Value, Calculated Value, Peak Value, Historical Value, etc.</dd>
            </di>
            <di>
                <dt><strong>Historical Value</strong></dt>
                <dd>A value stored in memory from a previous timestamp.</dd>
            </di>
            <di>
                <dt><strong>Identification Value</strong></dt>
                <dd>A value that can be used for identification. (Serial numbers, meter IDs, locations, names, etc.)</dd>
            </di>
            <di>
                <dt><strong>Localization information</strong></dt>
                <dd>Optional information for a field, allowing the sensor to control how the information should be presented to human viewers.</dd>
            </di>
            <di>
                <dt><strong>Meter</strong></dt>
                <dd>A device possible containing multiple sensors, used in metering applications. Examples: Electricity meter, Water Meter, Heat Meter, Cooling Meter, etc.</dd>
            </di>
            <di>
                <dt><strong>Momentary Value</strong></dt>
                <dd>A momentary value represents a value measured at the time of the read-out.</dd>
            </di>
            <di>
                <dt><strong>Node</strong></dt>
                <dd>
                    Graphs contain nodes and edges between nodes. In Internet of Things, sensors, actuators, meters, devices, gateways, etc., are often depicted as nodes whereas links between sensors (friendships)
                    are depicted as edges. In abstract terms, it's easier to talk about a Node, rather than list different possible node types (sensors, actuators, meters, devices, gateways, etc.).
                    Each Node has a Node ID.
                </dd>
            </di>
            <di>
                <dt><strong>Node ID</strong></dt>
                <dd>
                    An ID uniquely identifying a node within its corresponding context. If a globally unique ID is desired, an architecture should be used using a universally accepted
                    ID scheme.
                </dd>
            </di>
            <di>
                <dt><strong>Parameter</strong></dt>
                <dd>
                    Readable and/or writable property on a node/device. The XEP-0326 <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0326.html">Internet of Things - Concentrators</a></span>  [<a href="#nt-ID0ETGAC">6</a>] deals with reading and writing parameters
                    on nodes/devices. Fields are not parameters, and parameters are not fields.
                </dd>
            </di>
            <di>
                <dt><strong>Peak Value</strong></dt>
                <dd>A maximum or minimum value during a given period.</dd>
            </di>
            <di>
                <dt><strong>Provisioning Server</strong></dt>
                <dd>
                    An application that can configure a network and provide services to users or Things. In Internet of Things, a Provisioning Server knows who knows whom,
                    what privileges users have, who can read what data and who can control what devices and what parts of these devices.
                </dd>
            </di>
            <di>
                <dt><strong>Precision</strong></dt>
                <dd>
                    In physics, precision determines the number of digits of precision. In sensor networks however, this definition is not easily applicable. Instead, precision
                    determines, for example, the number of decimals of precision, or power of precision. Example: 123.200 MWh contains 3 decimals of precision. All entities parsing and
                    delivering field information in sensor networks should always retain the number of decimals in a message.
                </dd>
            </di>
            <di>
                <dt><strong>Sensor</strong></dt>
                <dd>
                    Device measuring at least one digital value (0 or 1) or analog value (value with precision and physical unit). Examples: Temperature sensor, pressure sensor, etc.
                    Sensor values are reported as fields during read-out. Each sensor has a unique Node ID.
                </dd>
            </di>
            <di>
                <dt><strong>SN</strong></dt>
                <dd>Sensor Network. A network consisting, but not limited to sensors, where transport and use of sensor data is of primary concern. A sensor network may contain actuators, network applications, monitors, services, etc.</dd>
            </di>
            <di>
                <dt><strong>Status Value</strong></dt>
                <dd>A value displaying status information about something.</dd>
            </di>
            <di>
                <dt><strong>Timestamp</strong></dt>
                <dd>Timestamp of value, when the value was sampled or recorded.</dd>
            </di>
            <di>
                <dt><strong>Thing</strong></dt>
                <dd>
                    Internet of Things basically consists of Things connected to the Internet. Things can be any device, sensor, actuator etc., that can have an
                    Internet connection.
                </dd>
            </di>
            <di>
                <dt><strong>Thing Registry</strong></dt>
                <dd>
                    A registry where Things can register for simple and secure discovery by the owner of the Thing. The registry can also be used as a database for meta information
                    about Things in the network.
                </dd>
            </di>
            <di>
                <dt><strong>Token</strong></dt>
                <dd>
                    A client, device or user can get a token from a provisioning server. These tokens can be included in requests to other entities in the network, so these entities can validate
                    access rights with the provisioning server.
                </dd>
            </di>
            <di>
                <dt><strong>Unit</strong></dt>
                <dd>Physical unit of value. Example: MWh, l/s, etc.</dd>
            </di>
            <di>
                <dt><strong>Value</strong></dt>
                <dd>A field value.</dd>
            </di>
            <di>
                <dt><strong>Value Status</strong></dt>
                <dd>Status of field value. Contains important status information for Quality of Service purposes. Examples: Ok, Error, Warning, Time Shifted, Missing, Signed, etc.</dd>
            </di>
            <di>
                <dt><strong>Value Type</strong></dt>
                <dd>Can be numeric, string, boolean, Date &amp; Time, Time Span or Enumeration.</dd>
            </di>
            <di>
                <dt><strong>WSN</strong></dt>
                <dd>Wireless Sensor Network, a sensor network including wireless devices.</dd>
            </di>
            <di>
                <dt><strong>XMPP Client</strong></dt>
                <dd>Application connected to an XMPP network, having a JID. Note that sensors, as well as applications requesting sensor data can be XMPP clients.</dd>
            </di>
        </dl>
    </div>
    <h2>3.
       <a name="usecases">Use Cases</a></h2>
        <p class="" style="">
            The life cycle of a Thing can be divided into multiple steps. The following sections will list many of these steps in possible order of occurrence during the
            life cycle of the Thing.
        </p>
        <div class="indent">
      <h3>3.1 <a name="sect-ID0EVKAC">Production</a></h3>
            <p class="" style="">
                During production of a Thing, decisions have to be made whether the following parameters should be pre-configured, manually entered after installation or
                automatically found and/or created by the device if possible (zero-configuration networking):
            </p>
            <ul class="" style="">
                <li class="" style="">
                    Address and domain of XMPP Server.
                </li>
                <li class="" style="">
                    JID of the Thing.
                </li>
                <li class="" style="">
                    JID of Thing Registry, if separate from the XMPP Server.
                </li>
                <li class="" style="">
                    JID of first Provisioning Server, if separate from Thing Registry or XMPP Server.
                </li>
            </ul>
            <p class="" style="">
                A decision has to be made at this point if global/manufacturer/customer servers should be used, or if local resources should be searched for and used if found. 
                Both have their merits, which will not be discussed in detail in this document. The first option is easy to configure in a production environment and might have commercial significance, 
                but cannot use local resources where available. The second leaves much responsibility to the Thing for finding local resources, but has the advantage of allowing for a more 
                decentralized network architecture.
            </p>
        </div>
        <div class="indent">
      <h3>3.2 <a name="sect-ID0EXLAC">Installation</a></h3>
            <p class="" style="">
                Apart from physical installation, and connection to power and communication infrastructure, the installation phase of a Thing might also require manual entry of values that
                could not be set in the production environment. Since Things might have very limited human user interfaces, external tools might be required to provide this information. Due 
                to its complexity, any manual entry of configuration parameters should be avoided, if possible. However, manual entry of some parameters might allow for Things to use local
                resources where such cannot be found nor set in a production environment.
            </p>
        </div>
        <div class="indent">
      <h3>3.3 <a name="sect-ID0EAMAC">Finding XMPP Server</a></h3>
            <p class="" style="">
                If the address of an XMPP Server is not preconfigured, the Thing must attempt to find one in its local surroundings. This can be done using one of several methods:
            </p>
            <ul class="" style="">
                <li class="" style="">DHCP</li>
                <li class="" style="">Multicast DNS</li>
                <li class="" style="">SSDP/UPnP</li>
            </ul>
            <p class="" style="">
                The following sections describe them in more detail.
            </p>
            <div class="indent">
        <h3>3.3.1 <a name="sect-ID0E4MAC">DHCP</a></h3>
                <p class="" style="">TBD</p>
                
            </div>
            <div class="indent">
        <h3>3.3.2 <a name="sect-ID0EINAC">DNS Service Discovery and Multicast DNS</a></h3>
                <p class="" style="">TBD</p>
                
                
            </div>
            <div class="indent">
        <h3>3.3.3 <a name="sect-ID0EVNAC">SSDP/UPnP</a></h3>
                <p class="" style="">TBD</p>
                
            </div>
            <p class="" style="">
                <span class="strong">Note:</span> If server-less messaging is to be used, as described in <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0174.html">Link-Local Messaging</a></span>  [<a href="#nt-ID0EMOAC">7</a>] this step can be used to find the Thing Registry and optionally the 
                Provisioning Server and other peers it want to connect to. The next section can thus be skipped.
            </p>
        </div>
        <div class="indent">
      <h3>3.4 <a name="sect-ID0EUOAC">Connection to XMPP Server</a></h3>
            <p class="" style="">
                Once an XMPP Server has been found a connection can be made. If multiple XMPP Servers are found, the client is free to choose the one that best suits its purposes.
            </p>
            <p class="" style="">
                If the Thing does not have an account already, one can be registered along what is specified in <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0077.html">In-Band Registration</a></span>  [<a href="#nt-ID0EGPAC">8</a>]. If multiple servers are available, the first XMPP server that 
                allows account creation can be used.
            </p>
        </div>
        <div class="indent">
      <h3>3.5 <a name="sect-ID0EOPAC">Finding Thing Registry</a></h3>
            <p class="" style="">
                If a Thing Registry is not preconfigured, one must be found. The following lists methods to obtaining the JID for the Thing Registry. Note that the last two
                have <a href="#security">security considerations</a> that need to be taken into account.
            </p>
            <ol start="" class="" style="">
                <li class="" style="">
                    Preconfigured JID to Thing Registry.
                </li>
                <li class="" style="">
                    Preconfigured user name only, on the same XMPP domain as the XMPP Server connected to.
                </li>
                <li class="" style="">
                    XMPP Server itself. This can be found out by sending a discovery request to the server,
                    as described in <a href="#support">Determining Support</a>.
                </li>
                <li class="" style="">
                    discovery on the same domain. (For example: discovery@jabber.org)
                </li>
                <li class="" style="">
                    Search for accounts on the XMPP server with nick-name "discovery". Search is performed using <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0055.html">Jabber Search</a></span>  [<a href="#nt-ID0E5AAE">9</a>]
                </li>
            </ol>
            <p class="" style="">
                <span class="strong">Note:</span> The above methods might yield multiple JIDs. Each should in turn be checked if the <a href="#support">support the discovery extension</a>.
                Note also that the last two have <a href="#security">security considerations</a> that need to be taken into account. These methods might be
                skipped, to avoid the possibility that an external user pretends to be a thing registry to hijack new Things installed into the network.
            </p>
        </div>
        <div class="indent">
      <h3>3.6 <a name="sect-ID0EUBAE">Registering Thing</a></h3>
            <p class="" style="">
                Once a Thing Registry has been found and been befriended, the Thing can register itself with the registry, as follows:
            </p>
            <p class="caption"><a name="example-1"></a>Example 1. Register Thing</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='thing@clayster.com/imc'
       to='discovery@clayster.com'
       id='1'&gt;
      &lt;register xmlns='urn:xmpp:iot:discovery'&gt;
          &lt;str name='SN' value='394872348732948723'/&gt;
          &lt;str name='MAN' value='www.ktc.se'/&gt;
          &lt;str name='MODEL' value='IMC'/&gt;
          &lt;num name='V' value='1.2'/&gt;
          &lt;str name='KEY' value='4857402340298342'/&gt;
      &lt;/register&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='discovery@clayster.com'
       to='thing@clayster.com/imc'
       id='1'/&gt;
            </pre>
      </div>
            <p class="" style="">
                There are two types of tags: Tags with string values and tags with numerical values. The distinction is important, since the type of value affects how
                comparisons are made later when performing searches in the registry.
            </p>
            <p class="" style="">
                The Thing should only register parameters required to be known by the owner of the Thing. Dynamic meta information must be avoided at this point.
                To claim the ownership of the Thing, the owner needs to present the same meta information as registered by the Thing. Before an owner has claimed 
                ownership of the Thing, it will not be returned in any search results. A list of predefined meta tag names can be found in the <a href="#tags">Meta Tags</a>
                section below.
            </p>
            <p class="" style="">
                The Thing can register itself as many times as it wants, and the response is always empty. Only one record per resource-less JID must be created. A new 
                registration overrides any previous information, including meta tags previously reported but not available in the new registration. Once a Thing has been 
                claimed by an owner, it should not register itself again, unless it is reset and the installation process restarted.
            </p>
        </div>
        <div class="indent">
      <h3>3.7 <a name="sect-ID0EQCAE">Register self-owned Thing</a></h3>
            <p class="" style="">
                If a thing is self-owned, it can register itself with the Registry as normal, with the addition of setting the attribute <span class="strong">selfOwned</span> to <span class="strong">true</span>,
                as is shown below. This registers the Thing directly as PUBLIC CLAIMED, with no need for an owner to claim ownership of the device. This can be useful if
                installing Things that should be publically available.
            </p>
            <p class="caption"><a name="example-2"></a>Example 2. Register self-owned Thing</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='thing@clayster.com/imc'
       to='discovery@clayster.com'
       id='2'&gt;
      &lt;register xmlns='urn:xmpp:iot:discovery' selfOwned='true'&gt;
          &lt;str name='SN' value='394872348732948723'/&gt;
          &lt;str name='MAN' value='www.ktc.se'/&gt;
          &lt;str name='MODEL' value='IMC'/&gt;
          &lt;num name='V' value='1.2'/&gt;
          &lt;str name='KEY' value='4857402340298342'/&gt;
      &lt;/register&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='discovery@clayster.com'
       to='thing@clayster.com/imc'
       id='2'/&gt;
            </pre>
      </div>
        </div>
        <div class="indent">
      <h3>3.8 <a name="sect-ID0EBDAE">Register Thing behind Concentrator</a></h3>
            <p class="" style="">
                A Thing might reside behind a gateway or concentrator and not be directly connected to the XMPP network itself, as is described in <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0326.html">Internet of Things - Concentrators</a></span>  [<a href="#nt-ID0EPDAE">10</a>]. In these cases there are three optional
                attributes that can be used to identify the Thing behind the JID: The <span class="strong">nodeId</span> attribute gives the ID of the Thing (a.k.a. "Node"). The Node might reside in
                specific Data Source (large systems might have multiple sources of nodes). In this case, the data source is specified in the <span class="strong">sourceId</span> attribute. Normally, the Node ID
                is considered to be unique within the concentrator. If multiple data sources are available, the Node ID is unique within the data source. However, a third attribute allows the uniqueness
                to be restricted to a given <span class="strong">cacheType</span>. Finally, it is the triple (<span class="strong">nodeId</span>, <span class="strong">sourceId</span>, <span class="strong">cacheType</span>) which guarantees
                uniqueness within the concentrator.
            </p>
            <p class="" style="">
                So, for a Thing controlled by a concentrator to register itself in the Thing Registry, it simply adds the optional attributes <span class="strong">nodeId</span>, <span class="strong">sourceId</span>
                and <span class="strong">cacheType</span> as appropriate to the registration request, as follows:
            </p>
            <p class="caption"><a name="example-3"></a>Example 3. Register Thing behind Concentrator</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='rack@clayster.com/plcs'
       to='discovery@clayster.com'
       id='3'&gt;
      &lt;register xmlns='urn:xmpp:iot:discovery' nodeId='imc1' sourceId='MeteringTopology'&gt;
          &lt;str name='SN' value='394872348732948723'/&gt;
          &lt;str name='MAN' value='www.ktc.se'/&gt;
          &lt;str name='MODEL' value='IMC'/&gt;
          &lt;num name='V' value='1.2'/&gt;
          &lt;str name='KEY' value='4857402340298342'/&gt;
      &lt;/register&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='discovery@clayster.com'
       to='rack@clayster.com/plcs'
       id='3'/&gt;
            </pre>
      </div>
            <p class="" style="">
                If the Thing behind the concentrator is self-owned, it simply adds the <span class="strong">selfOwned</span> attribute to the request and sets it to <span class="strong">true</span>.
            </p>
        </div>
        <div class="indent">
      <h3>3.9 <a name="sect-ID0E1EAE">Claiming Ownership of a Thing</a></h3>
            <p class="" style="">
                As mentioned above, the owner of the Thing must provide the information provided by the Thing to the Registry, in order to claim ownership over it. To avoid the
                possibility that somebody can guess the information, the information must necessarily be long. This creates the problem of transfer of information. One method to solve this
                is through the use of QR-codes. Such codes can be either printed on a sticker and put on the Thing itself, its wrapping, or displayed on its display when not claimed.
                This QR-code can then be photographed by a smart phone or tablet, decoded and the information retrieved can be used in the ownership claim call.
            </p>
            <p class="" style="">
                If QR-codes are used to transfer Thing meta data for ownership claims, it must be generated as follows: To the string "IoTDisco" is appended all meta tags in order.
                Before each tag name is prefixed a semi-colon (;), and if the tag is numeric an additional hash sign (#). Before each tag value a colon (:). If the meta value contains
                semi-colons or back-slashes, each one is prefixed by a back-slash. When decoding the string, this allows the decoder to correctly differ between tag delimiters and
                characters belonging to tag values. A tag name must never contain colon, hash sign or white space characters.
            </p>
            <p class="" style="">
                The above meta data would therefore generate the string:
            </p>
            <p class="caption"><a name="example-4"></a>Example 4. String to encode as a QR-code</p>
      <div class="indent">
        <pre class="prettyprint">
                
   IoTDisco;SN:394872348732948723;MAN:www.ktc.se;MODEL:IMC;#V:1.2;KEY:4857402340298342
            </pre>
      </div>
            <p class="" style="">
                Using UTF-8 encoding when generating the QR-code, this string returns the following QR-code:
            </p>
            <p class="" style="">
                <img alt="" src="https://chart.googleapis.com/chart?cht=qr&amp;chs=200x200&amp;chl=IoTDisco;SN:394872348732948723;MAN:www.ktc.se;MODEL:IMC;#V:1.2;KEY:4857402340298342">
            </p>
            <p class="" style="">
                To generate a QR-code, Google Chart API can be used: 
                <a href="https://chart.googleapis.com/chart?cht=qr&amp;chs=200x200&amp;chl=IoTDisco;SN:394872348732948723;MAN:www.ktc.se;MODEL:IMC;#V:1.2;KEY:4857402340298342">https://chart.googleapis.com/chart?cht=qr&amp;chs=200x200&amp;chl=IoTDisco;SN:394872348732948723;MAN:www.ktc.se;MODEL:IMC;#V:1.2;KEY:4857402340298342</a>
            </p>
            <p class="" style="">
                Once the client has the required meta information about the Thing to claim ownership, it sends itself the following request to the Think Registry:
            </p>
            <p class="caption"><a name="example-5"></a>Example 5. Claim Ownership</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='owner@clayster.com/phone'
       to='discovery@clayster.com'
       id='4'&gt;
      &lt;mine xmlns='urn:xmpp:iot:discovery'&gt;
          &lt;str name='SN' value='394872348732948723'/&gt;
          &lt;str name='MAN' value='www.ktc.se'/&gt;
          &lt;str name='MODEL' value='IMC'/&gt;
          &lt;num name='V' value='1.2'/&gt;
          &lt;str name='KEY' value='4857402340298342'/&gt;
      &lt;/mine&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                If the claim is successful, i.e. there's a Thing that has not been claimed with EXACTLY the same meta data (however, the order is not important), the Thing is marked in the
                Registry as CLAIMED, and an empty result is returned as follows. If there's a claimed Thing with exactly the same meta data, and the JID of the claimant (without resource)
                matches the JID of the claimer (without resource), a success response is also returned, containing the resource-less JID of the Thing, as follows:
            </p>
            <p class="caption"><a name="example-6"></a>Example 6. Ownership claim successful</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='result'
       from='discovery@clayster.com'
       to='owner@clayster.com/phone'
       id='4'&gt;
      &lt;claimed xmlns='urn:xmpp:iot:discovery' jid='thing@clayster.com'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                If the Thing that has been claimed resides behind a concentrator, the result will contain those of the attributes <span class="strong">nodeId</span>, <span class="strong">sourceId</span>
                and <span class="strong">cacheType</span> that are required to access the Thing in calls made using <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0323.html">Internet of Things - Sensor Data</a></span>  [<a href="#nt-ID0E6GAE">11</a>], <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0324.html">Internet of Things - Provisioning</a></span>  [<a href="#nt-ID0ELHAE">12</a>], <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0325.html">Internet of Things - Control</a></span>  [<a href="#nt-ID0EXHAE">13</a>] and <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0326.html">Internet of Things - Concentrators</a></span>  [<a href="#nt-ID0EDIAE">14</a>]. The following example illustrates
                a response where a Thing behind a Concentrator has been claimed:
            </p>
            <p class="caption"><a name="example-7"></a>Example 7. Ownership claim of a Thing behind a concentrator successful</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='result'
       from='discovery@clayster.com'
       to='owner@clayster.com/phone'
       id='4'&gt;
      &lt;claimed xmlns='urn:xmpp:iot:discovery' jid='rack@clayster.com/plcs' nodeId='imc1' sourceId='MeteringTopology'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                If, on the other hand, no such Thing was found, or if such a Thing was found, but it is already claimed by somebody else, a failure response is returned. This response
                should avoid to inform the client in detail why the claim failed, as follows:
            </p>
            <p class="caption"><a name="example-8"></a>Example 8. Ownership claim failure</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='error'
       from='discovery@clayster.com'
       to='owner@clayster.com/phone'
       id='4'&gt;
      &lt;error type='cancel'&gt;
         &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
      &lt;/error&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                When the Thing has been successfully claimed, the Registry sends information about this to the Thing, to inform it that it has been claimed and the resource-less JID of owner.
                After receiving this information, it doesn't need to register itself with the Registry anymore.
            </p>
            <p class="caption"><a name="example-9"></a>Example 9. Ownership claimed</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='discovery@clayster.com'
       to='thing@clayster.com/imc'
       id='5'&gt;
      &lt;claimed xmlns='urn:xmpp:iot:discovery' jid='owner@clayster.com'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                If the Thing resides behind a concentrator, the request must contain those of the attributes <span class="strong">nodeId</span>, <span class="strong">sourceId</span>
                and <span class="strong">cacheType</span> that are required to access the Thing, as follows:
            </p>
            <p class="caption"><a name="example-10"></a>Example 10. Ownership of Thing behind concentrator claimed</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='discovery@clayster.com'
       to='rack@clayster.com/plcs'
       id='5'&gt;
      &lt;claimed xmlns='urn:xmpp:iot:discovery' jid='owner@clayster.com' nodeId='imc1' sourceId='MeteringTopology'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                The Thing simply returns an empty response to acknowledge the receipt of the information, as follows:
            </p>
            <p class="caption"><a name="example-11"></a>Example 11. Ownership claimed acknowledged</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='result'
       from='thing@clayster.com/imc'
       to='discovery@clayster.com'
       id='5'/&gt;
            </pre>
      </div>
            <p class="" style="">
                After receiving this, the thing knows it can accept friendship requests from the corresponding owner. It can also safely send a friendship request to the owner.
            </p>
        </div>
        <div class="indent">
      <h3>3.10 <a name="sect-ID0EVJAE">Removing Thing from Registry</a></h3>
            <p class="" style="">
                After a Thing has been claimed, it is registered as a PUBLIC CLAIMED Thing in the Registry. This makes the Thing available in searches. The owner can choose to remove
                the Thing from the Registry, to avoid that the Thing appears in searches. To remove a Thing from the Registry the owner simply sends a removal request to the Registry
                with the resource-less JID of the Thing to remove, as follows:
            </p>
            <p class="caption"><a name="example-12"></a>Example 12. Remove Thing</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='owner@clayster.com/phone'
       to='discovery@clayster.com'
       id='6'&gt;
      &lt;remove xmlns='urn:xmpp:iot:discovery' jid='thing@clayster.com'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                If the Thing resides behind a concentrator, the request must contain those of the attributes <span class="strong">nodeId</span>, <span class="strong">sourceId</span>
                and <span class="strong">cacheType</span> that are required to access the Thing, as follows:
            </p>
            <p class="caption"><a name="example-13"></a>Example 13. Remove Thing behind concentrator</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='owner@clayster.com/phone'
       to='discovery@clayster.com'
       id='6'&gt;
      &lt;remove xmlns='urn:xmpp:iot:discovery' jid='rack@clayster.com/plcs' nodeId='imc1' sourceId='MeteringTopology'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                If such a Thing is found and is owned by the caller, it is removed from the Registry, and an empty response is returned, to acknowledge the removal of the Thing
                from the registry, as follows:
            </p>
            <p class="caption"><a name="example-14"></a>Example 14. Thing removed</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='result'
       from='discovery@clayster.com'
       to='owner@clayster.com/phone'
       id='6'/&gt;
            </pre>
      </div>
            <p class="" style="">
                However, if such a thing is not found, or if the thing is owned by another, an <span class="strong">item-not-found</span> error is returned, as follows:
            </p>
            <p class="caption"><a name="example-15"></a>Example 15. Ownership claim failure</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='error'
       from='discovery@clayster.com'
       to='owner@clayster.com/phone'
       id='6'&gt;
      &lt;error type='cancel'&gt;
         &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
      &lt;/error&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                After successfully removing a Thing from the Registry, and if the Thing is friend to the Registry, the Registry informs the Thing it has been removed from the Registry.
                It does this, so the Thing can remove the friendship and stop any meta data updates to the Registry.
            </p>
            <p class="caption"><a name="example-16"></a>Example 16. Thing removed from registry by owner</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='discovery@clayster.com'
       to='thing@clayster.com/imc'
       id='7'&gt;
      &lt;removed xmlns='urn:xmpp:iot:discovery'/&gt;
   &lt;/iq&gt;
   
   &lt;iq type='result'
       from='thing@clayster.com/imc'
       to='discovery@clayster.com'
       id='7'/&gt;
            </pre>
      </div>
        </div>
        <div class="indent">
      <h3>3.11 <a name="sect-ID0EHLAE">Finding Provisioning Server</a></h3>
            <p class="" style="">
                Up to this point only basic configuration and ownership and visibility of a Thing has been covered. For more advanced operations, a Thing might be required to
                use a Provisioning Server to whom it can delegate trust and allow making decisions, controlling access rights and privileges for the Thing, as described in <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0324.html">Internet of Things - Provisioning</a></span>  [<a href="#nt-ID0EVLAE">15</a>].
                If a Provisioning Server is not preconfigured, one must be found. The following lists methods to obtaining the JID for the Provisioning Server. Note that the last two
                have <a href="#security">security considerations</a> that need to be taken into account.
            </p>
            <ol start="" class="" style="">
                <li class="" style="">
                    Preconfigured JID to Provisioning Server.
                </li>
                <li class="" style="">
                    Preconfigured user name only, on the same XMPP domain as the XMPP Server connected to.
                </li>
                <li class="" style="">
                    The XMPP Server itself can be a Provisioning Server. This can be found out by sending a discovery request to the server,
                    as described in <a href="#support">Determining Support</a>.
                </li>
                <li class="" style="">
                    The Thing Registry itself can be a Provisioning Server. This can be found out by sending a discovery request to the Thing Registry,
                    as described in <a href="#support">Determining Support</a>.
                </li>
                <li class="" style="">
                    The Owner itself can be a Provisioning Server. This can be found out by sending a discovery request to the Thing Registry,
                    as described in <a href="#support">Determining Support</a>.
                </li>
                <li class="" style="">
                    provisioning on the same domain. (For example: provisioning@jabber.org)
                </li>
                <li class="" style="">
                    Search for accounts on the XMPP server with nick-name "provisioning". Search is performed using <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0055.html">Jabber Search</a></span>  [<a href="#nt-ID0ESNAE">16</a>]
                </li>
            </ol>
            <p class="" style="">
                <span class="strong">Note:</span> The above methods might yield multiple JIDs. Each should in turn be checked if the <a href="#support">support the discovery extension</a>.
                Note also that the last two have <a href="#security">security considerations</a> that need to be taken into account. These methods might be
                skipped, to avoid the possibility that an external user pretends to be a thing registry to hijack new Things installed into the network.
            </p>
        </div>
        <div class="indent">
      <h3>3.12 <a name="sect-ID0EIOAE">Delegating Trust</a></h3>
            <p class="" style="">
                Once a Provisioning Server has been found and been befriended, the Thing can delegate its trust to it, according to <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0324.html">Internet of Things - Provisioning</a></span>  [<a href="#nt-ID0EWOAE">17</a>].
            </p>
        </div>
        <div class="indent">
      <h3>3.13 <a name="sect-ID0E5OAE">Update Meta Information about Thing in Registry</a></h3>
            <p class="" style="">
                Once a Thing has been claimed and chooses to reside as a public Thing in the registry, it can update its meta information at any time. This meta information
                will be available in searches made to the registry by third parties and is considered public. However, the Thing should be connected to a provisioning server
                at this point, so that correct decisions can be made regarding to friendship, readout and control requests made by parties other than the owner.
            </p>
            <p class="" style="">
                Meta information updated in this way will only overwrite tags provided in the request, and leave other tags previously reported as is. To remove a string-valued tag,
                it should be updated with an empty value. It is also recommended that key meta information required to claim ownership of the Thing after a factory reset is
                either removed, truncated or otherwise modified after it has been claimed so that third parties with physical access to a public Thing cannot hijack it by searching 
                for it, extracting its meta information from the registry, then resetting it and then claiming ownership of it.
            </p>
            <p class="" style="">
                To update meta data about itself, a Thing simply sends a request to the Thing Registry, as follows:
            </p>
            <p class="caption"><a name="example-17"></a>Example 17. Update Meta Data request</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='thing@clayster.com/imc'
       to='discovery@clayster.com'
       id='8'&gt;
      &lt;update xmlns='urn:xmpp:iot:discovery'&gt;
          &lt;str name='KEY' value=''/&gt;
          &lt;str name='CLASS' value='PLC'/&gt;
          &lt;num name='LON' value='-71.519722'/&gt;
          &lt;num name='LAT' value='-33.008055'/&gt;
      &lt;/update&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                If the Thing resides behind a concentrator, the request must contain those of the attributes <span class="strong">nodeId</span>, <span class="strong">sourceId</span>
                and <span class="strong">cacheType</span> that are required to access the Thing, as follows:
            </p>
            <p class="caption"><a name="example-18"></a>Example 18. Update Meta Data of Thing behind concentrator</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='rack@clayster.com/plcs'
       to='discovery@clayster.com'
       id='8'&gt;
      &lt;update xmlns='urn:xmpp:iot:discovery' nodeId='imc1' sourceId='MeteringTopology'&gt;
          &lt;str name='KEY' value=''/&gt;
          &lt;str name='CLASS' value='PLC'/&gt;
          &lt;num name='LON' value='-71.519722'/&gt;
          &lt;num name='LAT' value='-33.008055'/&gt;
      &lt;/update&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                If the Thing is found in the registry, the registry simply acknowledges the update as follows:
            </p>
            <p class="caption"><a name="example-19"></a>Example 19. Update Meta Data request acknowledgement</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='result'
       from='discovery@clayster.com'
       to='thing@clayster.com/imc'
       id='8'/&gt;
            </pre>
      </div>
            <p class="" style="">
                However, if the Thing is not found in the registry, probably because the owner has removed it from the registry, an error response is returned. When receiving
                such a response, the Thing should assume it is the owner who has removed it from the registry, and that further meta data updates are not desired. The Thing
                can then unfriend the registry and stop further meta data updates. The error response from the registry would look as follows:
            </p>
            <p class="caption"><a name="example-20"></a>Example 20. Update Meta Data request failure</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='error'
       from='discovery@clayster.com'
       to='thing@clayster.com/imc'
       id='8'&gt;
      &lt;error type='cancel'&gt;
         &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
      &lt;/error&gt;
   &lt;/iq&gt;
            </pre>
      </div>
        </div>
        <div class="indent">
      <h3>3.14 <a name="sect-ID0EOQAE">Search for Public Things in Registry</a></h3>
            <p class="" style="">
                It is possible for anyone with access to the Thing Registry to search for public things that have been claimed, including self-owned Things. Such searches 
                will never return things that have not been claimed or have been removed from the registry.
            </p>
            <p class="" style="">
                A search is performed by providing one or more comparison operators in a search request to the registry. If more than one comparison operator is provided, the
                search is assumed to be performed on the intersection (i.e. AND) of all operators. If the union (i.e. OR) of different conditions is desired, multiple consecutive 
                searches have to be performed.
            </p>
            <p class="" style="">
                The following table lists available search operators, their element names and meanings:
            </p>
            <div class="indent">
        <p class="caption"><a name="table-2"></a>Table 2: Search operators</p>
        <table border="1" cellpadding="3" cellspacing="0">
                <tr class="body">
                    <th colspan="" rowspan="">Element</th>
                    <th colspan="" rowspan="">Type</th>
                    <th colspan="" rowspan="">Operator</th>
                    <th colspan="" rowspan="">Description</th>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">strEq</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">tag = c</td>
                    <td colspan="" rowspan="">Searches for string values tags with values equal to a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">strNEq</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">tag &lt;&gt; c</td>
                    <td colspan="" rowspan="">Searches for string values tags with values not equal to a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">strGt</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">tag &gt; c</td>
                    <td colspan="" rowspan="">Searches for string values tags with values greater than a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">strGtEq</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">tag &gt;= c</td>
                    <td colspan="" rowspan="">Searches for string values tags with values greater than or equal to a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">strLt</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">tag &lt; c</td>
                    <td colspan="" rowspan="">Searches for string values tags with values lesser than a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">strLtEq</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">tag &lt;= c</td>
                    <td colspan="" rowspan="">Searches for string values tags with values lesser than or equal to a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">strRange</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">min &lt;(=) tag &lt;(=) max</td>
                    <td colspan="" rowspan="">Searches for string values tags with values within a specified range of values. The endpoints can be included or excluded in the search.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">strNRange</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">tag &lt;(=) min OR tag &gt;(=) max</td>
                    <td colspan="" rowspan="">Searches for string values tags with values outside of a specified range of values. The endpoints can be included or excluded in the range (and therefore correspondingly excluded or included in the search).</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">strMask</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">tag LIKE c</td>
                    <td colspan="" rowspan="">Searches for string values tags with values similar to a provided constant value including wildcards.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">numEq</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">tag = c</td>
                    <td colspan="" rowspan="">Searches for numerical values tags with values equal to a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">numNEq</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">tag &lt;&gt; c</td>
                    <td colspan="" rowspan="">Searches for numerical values tags with values not equal to a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">numGt</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">tag &gt; c</td>
                    <td colspan="" rowspan="">Searches for numerical values tags with values greater than a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">numGtEq</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">tag &gt;= c</td>
                    <td colspan="" rowspan="">Searches for numerical values tags with values greater than or equal to a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">numLt</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">tag &lt; c</td>
                    <td colspan="" rowspan="">Searches for numerical values tags with values lesser than a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">numLtEq</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">tag &lt;= c</td>
                    <td colspan="" rowspan="">Searches for numerical values tags with values lesser than or equal to a provided constant value.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">numRange</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">min &lt;(=) tag &lt;(=) max</td>
                    <td colspan="" rowspan="">Searches for numerical values tags with values within a specified range of values. The endpoints can be included or excluded in the search.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">numNRange</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">tag &lt;(=) min OR tag &gt;(=) max</td>
                    <td colspan="" rowspan="">Searches for numerical values tags with values outside of a specified range of values. The endpoints can be included or excluded in the range (and therefore correspondingly excluded or included in the search).</td>
                </tr>
            </table>
      </div>
            <p class="" style="">
                The following example shows how a search for specific devices within a specific geographic area can be found. More precisely, it searches for a certain kind of PLC
                produced by a certain manufacturer, but only versions 1.0 &lt;= v &lt; 2.0 and with serial numbers beginning with 39487. The PLCs must also lie within latitude 33 ad 34 
                degrees south and between longitude 70 and 72 west.
            </p>
            <p class="caption"><a name="example-21"></a>Example 21. Searching for Things</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='get'
       from='curious@clayster.com/client'
       to='discovery@clayster.com'
       id='9'&gt;
      &lt;search xmlns='urn:xmpp:iot:discovery' offset='0' maxCount='100'&gt;
          &lt;strEq name='MAN' value='www.ktc.se'/&gt;
          &lt;strEq name='MODEL' value='IMC'/&gt;
          &lt;strMask name='SN' value='39487*' wildcard='*'/&gt;
          &lt;numRange name='V' min='1' minIncluded='true' max='2' maxIncluded='false'/&gt;
          &lt;numRange name='LON' min='-72' minIncluded='true' max='-70' maxIncluded='true'/&gt;
          &lt;numRange name='LAT' min='-33' minIncluded='true' max='-34' maxIncluded='true'/&gt;
      &lt;/update&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                The <span class="strong">offset</span> attribute tells the registry the number of responses to skip before returning found things. It provides a mechanism to page result sets
                that are too large to return in one response. the <span class="strong">maxCount</span> attribute contains the desired maximum number of things to return in the response. The
                registry can lower this value, if it decides the requested maximum number is too large.
            </p>
            <p class="" style="">
                If tag names are not found corresponding to the names provided in the search, the result set will always be empty. There's a reserved tag named <span class="strong">KEY</span>
                that can be used to provide information shared only between things and their owners. If a search contains an operator referencing this tag name, the result set
                must also always be empty. Searches on <span class="strong">KEY</span> MUST never find things. Furthermore, search results must never return <span class="strong">KEY</span> tags.
            </p>
            <p class="" style="">
                The registry returns any things found in a response similar to the following:
            </p>
            <p class="caption"><a name="example-22"></a>Example 22. Search result</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='result'
       from='discovery@clayster.com'
       to='curious@clayster.com/client'
       id='9'&gt;
      &lt;found xmlns='urn:xmpp:iot:discovery' more='false'&gt;
          &lt;thing owner='owner@clayster.com/phone' jid='thing@clayster.com/imc'&gt;
             &lt;str name='SN' value='394872348732948723'/&gt;
             &lt;str name='MAN' value='www.ktc.se'/&gt;
             &lt;str name='MODEL' value='IMC'/&gt;
             &lt;num name='V' value='1.2'/&gt;
             &lt;str name='CLASS' value='PLC'/&gt;
             &lt;num name='LON' value='-71.519722'/&gt;
             &lt;num name='LAT' value='-33.008055'/&gt;
          &lt;/thing&gt;
          ...
      &lt;/found&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                If a Thing resides behind a concentrator, the response must contain those of the attributes <span class="strong">nodeId</span>, <span class="strong">sourceId</span>
                and <span class="strong">cacheType</span> that are required to access the Thing, as follows:
            </p>
            <p class="caption"><a name="example-23"></a>Example 23. Search result containing Thing begind a concentrator</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='result'
       from='discovery@clayster.com'
       to='curious@clayster.com/client'
       id='9'&gt;
      &lt;found xmlns='urn:xmpp:iot:discovery' more='false'&gt;
          &lt;thing owner='owner@clayster.com/phone' jid='rack@clayster.com/plcs' nodeId='imc1' sourceId='MeteringTopology'&gt;
             &lt;str name='SN' value='394872348732948723'/&gt;
             &lt;str name='MAN' value='www.ktc.se'/&gt;
             &lt;str name='MODEL' value='IMC'/&gt;
             &lt;num name='V' value='1.2'/&gt;
             &lt;str name='CLASS' value='PLC'/&gt;
             &lt;num name='LON' value='-71.519722'/&gt;
             &lt;num name='LAT' value='-33.008055'/&gt;
          &lt;/thing&gt;
          ...
      &lt;/found&gt;
   &lt;/iq&gt;
            </pre>
      </div>
			<p class="" style="">
				If more results are available in the search (accessible by using the <span class="strong">offset</span> attribute in a new search), the <span class="strong">more</span> attribute is
				present with value <span class="strong">true</span>.
			</p>
        </div>
        <div class="indent">
      <h3>3.15 <a name="sect-ID0EU4AE">Unregistering Thing from Registry</a></h3>
            <p class="" style="">
                A thing can unregister itself from the Registry. This can be done in an uninstallation procedure for instance. To unregister from the registry, it simply sends
                an un-registration request to the registry as follows.
            </p>
            <p class="caption"><a name="example-24"></a>Example 24. Unregister Thing</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='thing@clayster.com/imc'
       to='discovery@clayster.com'
       id='10'&gt;
      &lt;unregister xmlns='urn:xmpp:iot:discovery'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                If the Thing resides behind a concentrator, the request must contain those of the attributes <span class="strong">nodeId</span>, <span class="strong">sourceId</span>
                and <span class="strong">cacheType</span> that are required to access the Thing, as follows:
            </p>
            <p class="caption"><a name="example-25"></a>Example 25. Ownership of Thing behind concentrator claimed</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='set'
       from='rack@clayster.com/plcs'
       to='discovery@clayster.com'
       id='10'&gt;
      &lt;unregister xmlns='urn:xmpp:iot:discovery' nodeId='imc1' sourceId='MeteringTopology'/&gt;
   &lt;/iq&gt;
            </pre>
      </div>
            <p class="" style="">
                The registry always returns an empty response, simply to acknowledge the receipt of the request.
            </p>
            <p class="caption"><a name="example-26"></a>Example 26. Unregister Thing acknowledgement</p>
      <div class="indent">
        <pre class="prettyprint">
                
   &lt;iq type='result'
       from='discovery@clayster.com'
       to='thing@clayster.com/imc'
       id='10'/&gt;
            </pre>
      </div>
        </div>
    <h2>4.
       <a name="support">Determining Support</a></h2>
        <p class="" style="">If an entity supports the protocol specified herein, it MUST advertise that fact by returning a feature of "urn:xmpp:iot:discovery" in response to <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0030.html">Service Discovery</a></span>  [<a href="#nt-ID0EE6AE">18</a>] information requests.</p>
        <p class="caption"><a name="example-27"></a>Example 27. Service discovery information request</p>
    <div class="indent">
      <pre class="prettyprint">
            
&lt;iq type='get'
    from='device@clayster.com/device'
    to='provisioning@clayster.com'
    id='disco1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
        </pre>
    </div>
        <p class="caption"><a name="example-28"></a>Example 28. Service discovery information response</p>
    <div class="indent">
      <pre class="prettyprint">
            
&lt;iq type='result'
    from='provisioning@clayster.com'
    to='device@clayster.com/device'
    id='disco1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    ...
    &lt;feature var='urn:xmpp:iot:discovery'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
        </pre>
    </div>
        <p class="" style="">
            In order for an application to determine whether an entity supports this protocol, where possible it SHOULD use the dynamic, presence-based profile of service discovery defined
            in <span class="ref" style=""><a href="http://xmpp.org/extensions/xep-0115.html">Entity Capabilities</a></span>  [<a href="#nt-ID0E26AE">19</a>]. However, if an application has not received entity capabilities information from an entity, it SHOULD use explicit service discovery instead.
        </p>
    <h2>5.
       <a name="impl">Implementation Notes</a></h2>
        <div class="indent">
      <h3>5.1 <a name="tags">Meta Tags</a></h3>
            <p class="" style="">
                This document does not limit the number or names of tags used by Things to register meta information about themselves. However, it provides some general limits and defines
                the meaning of a few tags that must have the meanings specified herein.
            </p>
            <p class="" style="">
                The maximum length of a tag name is <span class="strong">32</span> characters. Tag names must not include colon (:), hash sign (#) or white space characters. String tag values
                must not exceed 128 characters in length.
            </p>
            <p class="" style="">
                The following table lists predefined tag names and their corresponding meanings.
            </p>
            <div class="indent">
        <p class="caption"><a name="table-3"></a>Table 3: Predefined tags</p>
        <table border="1" cellpadding="3" cellspacing="0">
                <tr class="body">
                    <th colspan="" rowspan="">Tag Name</th>
                    <th colspan="" rowspan="">Type</th>
                    <th colspan="" rowspan="">Description</th>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">ALT</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">Altitude (meters)</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">APT</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Apartment associated with the Thing</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">AREA</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Area associated with the Thing</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">BLD</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Building associated with the Thing</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">CITY</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">City associated with the Thing</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">CLASS</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Class of Thing</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">COUNTRY</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Country associated with the Thing</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">KEY</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Key, shared between thing and owner.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">LAT</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">Latitude (degrees)</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">LON</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">Longitude (degrees)</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">MAN</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Domain name owned by the Manufacturer</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">MLOC</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Meter Location ID</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">MNR</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Meter Number</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">MODEL</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Name of Model</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">NAME</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Name associated with the Thing</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">PURL</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">URL to product information for the Thing.</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">REGION</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Region associated with the Thing</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">SN</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Serial Number</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">STREET</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Street Name</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">STREETNR</td>
                    <td colspan="" rowspan="">String</td>
                    <td colspan="" rowspan="">Street Number</td>
                </tr>
                <tr class="body">
                    <td colspan="" rowspan="">V</td>
                    <td colspan="" rowspan="">Numeric</td>
                    <td colspan="" rowspan="">Version Number</td>
                </tr>
            </table>
      </div>
            <p class="" style="">
                It is up to the Thing Registry to choose which tags it persists and which tags it doesn't. To avoid the possibility of malicious reporting of tags, some limit should be
                imposed on what tags are supported. As a minimum, a Thing Registry must support all predefined tags, as listed above.
            </p>
        </div>
        <div class="indent">
      <h3>5.2 <a name="sect-ID0EOLAG">Friendships between Things and Registry</a></h3>
            <p class="" style="">
                In the case the Thing Registry is not the XMPP Server to which the Thing is connected, a friendship relationship between the Thing and the Thing Registry needs to be handled.
                To minimize the number of concurrent friends the Thing Registry needs to maintain, a Thing must only maintain an active friendship with the registry if it needs to 
                communicate with the registry. This means that unless updating meta data frequently, the Thing must unfriend the Registry when done with its communication. If only
                updating meta data intermittently, the friendship can be reestablished when needed, and removed when done.
            </p>
        </div>
    <h2>6.
       <a name="security">Security Considerations</a></h2>
        <div class="indent">
      <h3>6.1 <a name="sect-ID0E3LAG">Hijacking predefined JIDs</a></h3>
            <p class="" style="">
                If using predefined user names when searching for a Thing Registry or Provisioning Server, care must be taken to which XMPP Server things connect.
                It might be possible for third parties to register these predefined account names (for example discovery@jabber.org or provisioning@jabber.org), and
                pretend to be a Thing Registry or Provisioning Server and in this way hijack unsuspecting Things. If installing things using this method of finding
                a Thing Registry or Provisioning Server, these accounts must be registered beforehand, to make sure the things cannot be hijacked.
            </p>
        </div>
        <div class="indent">
      <h3>6.2 <a name="sect-ID0EFMAG">Hijacking nicknames</a></h3>
            <p class="" style="">
                If searching for accounts with predefined nick names when searching for a Thing Registry or Provisioning Server, care must be taken to which XMPP Server things connect.
                It might be possible for third parties to register accounts with similar nicknames and pretend to be a Thing Registry or Provisioning Server and in this way hijack unsuspecting Things. 
                If installing things using this method of finding a Thing Registry or Provisioning Server, care must be taken so that undesired third parties are not allowed to create accounts
                on the server.
            </p>
        </div>
        <div class="indent">
      <h3>6.3 <a name="sect-ID0EOMAG">Hijacking things in public areas</a></h3>
            <p class="" style="">
                The combination of visible key meta information (perhaps in a visible QR-code) and a factory default reset button on a Thing, opens up the possibility to hijack the Thing.
                To avoid this, at least one of the two should be removed after successful installation. Either the key meta information (QR-code) should be placed on the package or separate
                paper and not on the thing itself, or the factory default reset button should be sealed or hidden and only accessible by licensed maintenance personell. If using an electronic
                means to present the key meta information (for instance by displayed a QR-code on a display on the thing), care should be taken so that the information cannot be displayed
                without breaking a seal, or other means to protect the Thing.
            </p>
            <p class="" style="">
                Regardless the above security measures, a Thing can be hijacked by a third party in the time window between successful installation of the device and until the correct owner
                has claimed ownership of the device. Minimizing this time window, and using a shared secret (KEY tag) between the Thing and its owner, decreases the possibility of getting the
                thing hijacked.
            </p>
        </div>
        <div class="indent">
      <h3>6.4 <a name="sect-ID0E2MAG">Key meta information in searches</a></h3>
            <p class="" style="">
                Care should be taken what key meta information is used to accept an ownership claim. After a successful claim, this meta information is still available in the registry,
                at least until the Thing is removed from the registry. While public in the registry, the meta information can be searched and presented to third parties. Access to this
                information can help third parties to hijack Things, if they can reset them to factory default settings.
            </p>
            <p class="" style="">
                To avoid this, the Thing can do three things after a successful ownership claim:
            </p>
            <ul class="" style="">
                <li class="" style="">
                    Including a <span class="strong">KEY</span> tag in the key meta information. The <span class="strong">KEY</span> tag is not searchable nor presented in search results.
                </li>
                <li class="" style="">
                    Remove, truncate or change some key meta information after a successful ownership claim. Partial information is not sufficient for a successful ownership claim.
                </li>
                <li class="" style="">
                    Remove the Thing from the registry.
                </li>
            </ul>
        </div>
        <div class="indent">
      <h3>6.5 <a name="sect-ID0E5NAG">KEY tag</a></h3>
            <p class="" style="">
                The <span class="strong">KEY</span> tag is unique in that it is not searchable nor available is search results. For this reason it is ideal for providing secrets shared only
                between the Thing and the owner. By providing a sufficiently long KEY value in the key meta information required to claim the Thing, guessing the information even though
                the other meta information is available, will be sufficiently hard to make it practically impossible.
            </p>
            <p class="" style="">
                Event though the <span class="strong">KEY</span> tag is not searchable or available in search results, it should be emptied by the Thing after a successful claim, just to make sure
                the key cannot be learned by looking into the database of the registry, or by some other means.
            </p>
        </div>
        <div class="indent">
      <h3>6.6 <a name="sect-ID0EROAG">Tag name spam</a></h3>
            <p class="" style="">
                This document does not limit tag names or the number of tags that can be used by Things. This opens up the possibility of tag spam. Malicious things could fill the database
                of the registry by reporting random tag names until the database is full.
            </p>
            <p class="" style="">
                To prevent such malicious attacks, the registry could limit the tags it allows to be stored in the database. The registry must however allow the storage of the predefined
                tag names defined in this document. If it has a configurable list of approved tags that can be stored, or if it allows any tags is an implementation decision.
            </p>
        </div>
    <h2>7.
       <a name="iana">IANA Considerations</a></h2>
        <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-ID0ENPAG">20</a>].</p>
    <h2>8.
       <a name="registrar">XMPP Registrar Considerations</a></h2>
        <p class="" style="">
            The <a href="#schema">protocol schema</a> needs to be added to the list of <a href="http://xmpp.org/resources/schemas/">XMPP protocol schemas</a>.
        </p>
    <h2>9.
       <a name="schema">XML Schema</a></h2>
        <p class="caption">
    </p>
    <div class="indent">
      <pre class="prettyprint">
            
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:xmpp:iot:discovery'
    xmlns='urn:xmpp:iot:discovery'
    elementFormDefault='qualified'&gt;
 
    &lt;xs:element name='register' type='Register'/&gt;
    &lt;xs:element name='mine' type='MetaData'/&gt;
    &lt;xs:element name='update' type='MetaData'/&gt;
 
    &lt;xs:element name='claimed' type='Jid'/&gt;
    &lt;xs:element name='remove' type='Jid'/&gt;
    &lt;xs:element name='removed' type='NodeInfo'/&gt;
    &lt;xs:element name='unregister' type='NodeInfo'/&gt;
 
    &lt;xs:element name='search'&gt;
        &lt;xs:complexType&gt;
            &lt;xs:choice minOccurs='1' maxOccurs='unbounded'&gt;
                &lt;xs:element name='strEq' type='StrTag'/&gt;
                &lt;xs:element name='strNEq' type='StrTag'/&gt;
                &lt;xs:element name='strGt' type='StrTag'/&gt;
                &lt;xs:element name='strGtEq' type='StrTag'/&gt;
                &lt;xs:element name='strLt' type='StrTag'/&gt;
                &lt;xs:element name='strLtEq' type='StrTag'/&gt;
                &lt;xs:element name='strRange' type='StrRange'/&gt;
                &lt;xs:element name='strNRange' type='StrRange'/&gt;
                &lt;xs:element name='strMask'&gt;
                    &lt;xs:complexType&gt;
                        &lt;xs:attribute name='name' type='xs:string' use='required'/&gt;
                        &lt;xs:attribute name='value' type='xs:string' use='required'/&gt;
                        &lt;xs:attribute name='wildcard' type='xs:string' use='required'/&gt;
                    &lt;/xs:complexType&gt;
                &lt;/xs:element&gt;
                &lt;xs:element name='numEq' type='NumTag'/&gt;
                &lt;xs:element name='numNEq' type='NumTag'/&gt;
                &lt;xs:element name='numGt' type='NumTag'/&gt;
                &lt;xs:element name='numGtEq' type='NumTag'/&gt;
                &lt;xs:element name='numLt' type='NumTag'/&gt;
                &lt;xs:element name='numLtEq' type='NumTag'/&gt;
                &lt;xs:element name='numRange' type='NumRange'/&gt;
                &lt;xs:element name='numNRange' type='NumRange'/&gt;
            &lt;/xs:choice&gt;
            &lt;xs:attribute name='offset' type='xs:nonNegativeInteger' use='optional' default='0'/&gt;
            &lt;xs:attribute name='maxCount' type='xs:positiveInteger' use='optional'/&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:element name='found'&gt;
        &lt;xs:complexType&gt;
            &lt;xs:sequence minOccurs='0' maxOccurs='unbounded'&gt;
                &lt;xs:element name='thing'&gt;
                    &lt;xs:complexType&gt;
                        &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
                            &lt;xs:element name='str' type='StrTag'/&gt;
                            &lt;xs:element name='num' type='NumTag'/&gt;
                        &lt;/xs:choice&gt;
                        &lt;xs:attribute name='owner' type='xs:string' use='required'/&gt;
                        &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
                        &lt;xs:attributeGroup ref='nodeInfo'/&gt;
                    &lt;/xs:complexType&gt;
                &lt;/xs:element&gt;
            &lt;/xs:sequence&gt;
            &lt;xs:attribute name='more' type='xs:boolean' use='optional' default='false'/&gt;
        &lt;/xs:complexType&gt;
    &lt;/xs:element&gt;
 
    &lt;xs:attributeGroup name='nodeInfo'&gt;
        &lt;xs:attribute name='nodeId' type='xs:string' use='optional'/&gt;
        &lt;xs:attribute name='sourceId' type='xs:string' use='optional'/&gt;
        &lt;xs:attribute name='cacheType' type='xs:string' use='optional'/&gt;
    &lt;/xs:attributeGroup&gt;
    
    &lt;xs:complexType name='MetaData'&gt;
        &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
            &lt;xs:element name='str' type='StrTag'/&gt;
            &lt;xs:element name='num' type='NumTag'/&gt;
        &lt;/xs:choice&gt;
        &lt;xs:attributeGroup ref='nodeInfo'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='Register'&gt;
        &lt;xs:complexContent&gt;
            &lt;xs:extension base='MetaData'&gt;
                &lt;xs:attribute name='selfOwned' type='xs:boolean' use='optional' default='false'/&gt;
            &lt;/xs:extension&gt;
        &lt;/xs:complexContent&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='Jid'&gt;
        &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
        &lt;xs:attributeGroup ref='nodeInfo'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='NodeInfo'&gt;
        &lt;xs:attributeGroup ref='nodeInfo'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='StrTag'&gt;
        &lt;xs:attribute name='name' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='value' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='NumTag'&gt;
        &lt;xs:attribute name='name' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='value' type='xs:double' use='required'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='StrRange'&gt;
        &lt;xs:attribute name='name' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='min' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='minIncluded' type='xs:boolean' use='optional' default='true'/&gt;
        &lt;xs:attribute name='max' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='maxIncluded' type='xs:boolean' use='optional' default='true'/&gt;
    &lt;/xs:complexType&gt;
 
    &lt;xs:complexType name='NumRange'&gt;
        &lt;xs:attribute name='name' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='min' type='xs:double' use='required'/&gt;
        &lt;xs:attribute name='minIncluded' type='xs:boolean' use='optional' default='true'/&gt;
        &lt;xs:attribute name='max' type='xs:double' use='required'/&gt;
        &lt;xs:attribute name='maxIncluded' type='xs:boolean' use='optional' default='true'/&gt;
    &lt;/xs:complexType&gt;
 
&lt;/xs:schema&gt;
        </pre>
    </div>
    <h2>10.
       <a name="moreinfo">For more information</a></h2>
        <p class="" style="">
            For more information, please see the following resources:
        </p>
        <ul class="" style="">
            <li class="" style="">
                <p class="" style="">
                    The <a href="http://wiki.xmpp.org/web/Tech_pages/SensorNetworks">Sensor Network section of the XMPP Wiki</a> contains further information about the
                    use of the sensor network XEPs, links to implementations, discussions, etc.
                </p>
            </li>
            <li class="" style="">
                <p class="" style="">
                    The XEP's and related projects are also available on <a href="https://github.com/joachimlindborg/">github</a>, thanks to Joachim Lindborg.
                </p>
            </li>
            <li class="" style="">
                <p class="" style="">
                    A presentation giving an overview of all extensions related to Internet of Things can be found here: 
                    <a href="http://prezi.com/esosntqhewhs/iot-xmpp/">http://prezi.com/esosntqhewhs/iot-xmpp/</a>.
                </p>
            </li>
        </ul>
    <h2>11.
       <a name="ack">Acknowledgements</a></h2>
        <p class="" style="">Thanks to ... for all valuable feedback.</p>
    <hr><a name="appendices"></a><h2>Appendices</h2>
    <hr><a name="appendix-docinfo"></a><h3>Appendix A: Document Information</h3>
    <p class="indent">
            Series: <a href="http://xmpp.org/extensions/">XEP</a><br>
            Number: xxxx<br>
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br>
            Status: 
            <a href="http://xmpp.org/extensions/xep-0001.html#states-ProtoXEP">ProtoXEP</a><br>
            Type:
            <a href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br>
            Version: 0.0.1<br>
            Last Updated: 2014-02-18<br>
                Approving Body: <a href="http://xmpp.org/council/">XMPP Council</a><br>Dependencies: XMPP Core, XEP-0001, XEP-0030, XEP-0077, XEP-0174, XEP-0323, XEP-0324, XEP-0325, XEP-0326<br>
                Supersedes: None<br>
                Superseded By: None<br>
            Short Name: NOT_YET_ASSIGNED<br>
            This document in other formats: 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-xxxx.xml">XML</a> 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-xxxx.pdf">PDF</a></p>
    <hr><a name="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3>
    <div class="indent">
      <h3>Peter Waher</h3>
      <p class="indent">
        Email:
        <a href="mailto:peter.waher@clayster.com">peter.waher@clayster.com</a><br>
        JabberID: 
        <a href="xmpp:peter.waher@jabber.org">peter.waher@jabber.org</a><br>
        URI: 
        <a href="http://www.linkedin.com/in/peterwaher">http://www.linkedin.com/in/peterwaher</a><br></p>
    </div>
    <hr><a name="appendix-legal"></a><h3>Appendix C: Legal Notices</h3>
    <div class="indent">
      <h4>Copyright</h4>This XMPP Extension Protocol is copyright © 1999 - 2013 by the <a href="http://xmpp.org/">XMPP Standards Foundation</a> (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="http://xmpp.org/about-xmpp/xsf/xsf-ipr-policy/">http://xmpp.org/about-xmpp/xsf/xsf-ipr-policy/</a>&gt; or obtained by writing to XMPP Standards Foundation, 1899 Wynkoop Street, Suite 600, Denver, CO 80202 USA).</div>
    <hr><a name="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3>
    <p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p>
    <hr><a name="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3>
    <p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p>
    <p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p>
    <p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p>
    <hr><a name="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3>
    <p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p>
    <hr><a name="appendix-notes"></a><h3>Appendix G: Notes</h3>
    <div class="indent">
      <p><a name="nt-ID0EWAAC">1</a>. XEP-0004: Data Forms &lt;<a href="http://xmpp.org/extensions/xep-0004.html">http://xmpp.org/extensions/xep-0004.html</a>&gt;.</p>
      <p><a name="nt-ID0ENBAC">2</a>. XEP-0004: Data Forms &lt;<a href="http://xmpp.org/extensions/xep-0004.html">http://xmpp.org/extensions/xep-0004.html</a>&gt;.</p>
      <p><a name="nt-ID0EZBAC">3</a>. XEP-0122: Data Forms Validation &lt;<a href="http://xmpp.org/extensions/xep-0122.html">http://xmpp.org/extensions/xep-0122.html</a>&gt;.</p>
      <p><a name="nt-ID0EFCAC">4</a>. XEP-0137: Publishing Stream Initiation Requests &lt;<a href="http://xmpp.org/extensions/xep-0137.html">http://xmpp.org/extensions/xep-0137.html</a>&gt;.</p>
      <p><a name="nt-ID0ERCAC">5</a>. XEP-0141: Data Forms Layout &lt;<a href="http://xmpp.org/extensions/xep-0141.html">http://xmpp.org/extensions/xep-0141.html</a>&gt;.</p>
      <p><a name="nt-ID0ETGAC">6</a>. XEP-0326: Internet of Things - Concentrators &lt;<a href="http://xmpp.org/extensions/xep-0326.html">http://xmpp.org/extensions/xep-0326.html</a>&gt;.</p>
      <p><a name="nt-ID0EMOAC">7</a>. XEP-0174: Link-Local Messaging &lt;<a href="http://xmpp.org/extensions/xep-0174.html">http://xmpp.org/extensions/xep-0174.html</a>&gt;.</p>
      <p><a name="nt-ID0EGPAC">8</a>. XEP-0077: In-Band Registration &lt;<a href="http://xmpp.org/extensions/xep-0077.html">http://xmpp.org/extensions/xep-0077.html</a>&gt;.</p>
      <p><a name="nt-ID0E5AAE">9</a>. XEP-0055: Jabber Search &lt;<a href="http://xmpp.org/extensions/xep-0055.html">http://xmpp.org/extensions/xep-0055.html</a>&gt;.</p>
      <p><a name="nt-ID0EPDAE">10</a>. XEP-0326: Internet of Things - Concentrators &lt;<a href="http://xmpp.org/extensions/xep-0326.html">http://xmpp.org/extensions/xep-0326.html</a>&gt;.</p>
      <p><a name="nt-ID0E6GAE">11</a>. XEP-0323: Internet of Things - Sensor Data &lt;<a href="http://xmpp.org/extensions/xep-0323.html">http://xmpp.org/extensions/xep-0323.html</a>&gt;.</p>
      <p><a name="nt-ID0ELHAE">12</a>. XEP-0324: Internet of Things - Provisioning &lt;<a href="http://xmpp.org/extensions/xep-0324.html">http://xmpp.org/extensions/xep-0324.html</a>&gt;.</p>
      <p><a name="nt-ID0EXHAE">13</a>. XEP-0325: Internet of Things - Control &lt;<a href="http://xmpp.org/extensions/xep-0325.html">http://xmpp.org/extensions/xep-0325.html</a>&gt;.</p>
      <p><a name="nt-ID0EDIAE">14</a>. XEP-0326: Internet of Things - Concentrators &lt;<a href="http://xmpp.org/extensions/xep-0326.html">http://xmpp.org/extensions/xep-0326.html</a>&gt;.</p>
      <p><a name="nt-ID0EVLAE">15</a>. XEP-0324: Internet of Things - Provisioning &lt;<a href="http://xmpp.org/extensions/xep-0324.html">http://xmpp.org/extensions/xep-0324.html</a>&gt;.</p>
      <p><a name="nt-ID0ESNAE">16</a>. XEP-0055: Jabber Search &lt;<a href="http://xmpp.org/extensions/xep-0055.html">http://xmpp.org/extensions/xep-0055.html</a>&gt;.</p>
      <p><a name="nt-ID0EWOAE">17</a>. XEP-0324: Internet of Things - Provisioning &lt;<a href="http://xmpp.org/extensions/xep-0324.html">http://xmpp.org/extensions/xep-0324.html</a>&gt;.</p>
      <p><a name="nt-ID0EE6AE">18</a>. XEP-0030: Service Discovery &lt;<a href="http://xmpp.org/extensions/xep-0030.html">http://xmpp.org/extensions/xep-0030.html</a>&gt;.</p>
      <p><a name="nt-ID0E26AE">19</a>. XEP-0115: Entity Capabilities &lt;<a href="http://xmpp.org/extensions/xep-0115.html">http://xmpp.org/extensions/xep-0115.html</a>&gt;.</p>
      <p><a name="nt-ID0ENPAG">20</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p>
    </div>
    <hr><a name="appendix-revs"></a><h3>Appendix H: Revision History</h3>
    <p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p>
    <div class="indent">
      <h4>Version 0.0.1 (2014-02-18)</h4>
      <div class="indent">
                <p class="" style="">First draft.</p>
             (pw)
    </div>
    </div>
    <hr>
    <p>END</p>
  </body>
</html>